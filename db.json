{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/images/avatar.jpeg","path":"images/avatar.jpeg","modified":0,"renderable":0},{"_id":"source/images/ngrok1.png","path":"images/ngrok1.png","modified":0,"renderable":0},{"_id":"themes/pure/source/favicon.png","path":"favicon.png","modified":0,"renderable":1},{"_id":"source/images/ngrok2.png","path":"images/ngrok2.png","modified":0,"renderable":0},{"_id":"source/images/home.jpg","path":"images/home.jpg","modified":0,"renderable":0},{"_id":"themes/pure/source/fonts/README.md","path":"fonts/README.md","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.eot","path":"fonts/iconfont.eot","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.ttf","path":"fonts/iconfont.ttf","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.woff","path":"fonts/iconfont.woff","modified":0,"renderable":1},{"_id":"themes/pure/source/images/thumb-default.png","path":"images/thumb-default.png","modified":0,"renderable":1},{"_id":"themes/pure/source/js/application.js","path":"js/application.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/application.min.js","path":"js/application.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/insight.js","path":"js/insight.js","modified":0,"renderable":1},{"_id":"source/images/ngrok3.jpg","path":"images/ngrok3.jpg","modified":0,"renderable":0},{"_id":"themes/pure/source/js/jquery.min.js","path":"js/jquery.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.js","path":"js/plugin.js","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.min.js","path":"js/plugin.min.js","modified":0,"renderable":1},{"_id":"themes/pure/source/css/style.css","path":"css/style.css","modified":0,"renderable":1},{"_id":"themes/pure/source/css/style.min.css","path":"css/style.min.css","modified":0,"renderable":1},{"_id":"themes/pure/source/fonts/iconfont.svg","path":"fonts/iconfont.svg","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/chuangzaoshi-logo.png","path":"images/favatar/chuangzaoshi-logo.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/favatar/idesign-logo.png","path":"images/favatar/idesign-logo.png","modified":0,"renderable":1},{"_id":"themes/pure/source/js/plugin.js.map","path":"js/plugin.js.map","modified":0,"renderable":1},{"_id":"source/images/pdf.jpg","path":"images/pdf.jpg","modified":0,"renderable":0},{"_id":"themes/pure/source/images/donate/wechatpayimg.png","path":"images/donate/wechatpayimg.png","modified":0,"renderable":1},{"_id":"themes/pure/source/images/donate/alipayimg.jpeg","path":"images/donate/alipayimg.jpeg","modified":0,"renderable":1},{"_id":"themes/pure/source/images/avatar.jpg","path":"images/avatar.jpg","modified":1,"renderable":1}],"Cache":[{"_id":"themes/pure/.gitignore","hash":"dbb41a2f30c98cb9de173d82736c46266c901cda","modified":1532976952000},{"_id":"themes/pure/LICENSE","hash":"c480fce396b23997ee23cc535518ffaaf7f458f8","modified":1532976952000},{"_id":"themes/pure/README.cn.md","hash":"a580852da41e27b6458b3996f9b3d4641a688449","modified":1532976952000},{"_id":"themes/pure/README.md","hash":"5861cec81712af9197a210fd5212d007aad8b0de","modified":1532976952000},{"_id":"themes/pure/_config.yml","hash":"be161c11dc8cf3b8be694b5002efe1b7aa898c72","modified":1533883902000},{"_id":"themes/pure/_config.yml.example","hash":"d522753943b5a774d7143eee783834453bb593d7","modified":1532976952000},{"_id":"themes/pure/package.json","hash":"a61723eead5cae2c4d9f0f05cf40d2de7c286fee","modified":1532976952000},{"_id":"source/_posts/与小程序间的相爱相杀.md","hash":"99901e3ea3a0e9286ef3ee52566e18464519fe46","modified":1533881898000},{"_id":"source/_posts/CSS实现文字滚动，类似公告展示.md","hash":"b246b66803369105a1f996a7fb5aca5143d011e4","modified":1526557466000},{"_id":"source/_posts/ngrok.md","hash":"e358892807e27ae0e0c4e878f3c9e4330e7b4965","modified":1523264957000},{"_id":"source/_posts/wx_sdk.md","hash":"b98e82ee25e557f08a307b1490f3684881b1514f","modified":1524131632000},{"_id":"source/_posts/图片压缩.md","hash":"eccba81fe326d16bfe91dee4526442459c56fc6a","modified":1523266978000},{"_id":"source/_posts/前端预览文件.md","hash":"49f7b09c0715462244434826dc9571f1a874c3d7","modified":1526546017000},{"_id":"source/_posts/预览PDF文件.md","hash":"6e5f4de461b98bd6c8efd415eb4bd2c9447d0e9e","modified":1526639707000},{"_id":"source/images/avatar.jpeg","hash":"79c349c84e1c491712804f07214c06fc045d14a3","modified":1523260980000},{"_id":"source/images/ngrok1.png","hash":"afca08b310edc1ac853bc9c8a04736e0e3fc6fbc","modified":1523101024000},{"_id":"themes/pure/languages/default.yml","hash":"167ea0db98f4db156ea68c4644f64c0287ae2b6f","modified":1532976952000},{"_id":"themes/pure/languages/en.yml","hash":"167ea0db98f4db156ea68c4644f64c0287ae2b6f","modified":1532976952000},{"_id":"themes/pure/languages/zh-CN.yml","hash":"057ebc043f09449af9768791c89c86dfc2938365","modified":1532976952000},{"_id":"themes/pure/languages/zh-TW.yml","hash":"6d27c3114be539b8783ffce944f68b2e26a8c3b9","modified":1532976952000},{"_id":"themes/pure/layout/about.ejs","hash":"4f5c769e183249b12eb9d3141432bc0039519730","modified":1532976952000},{"_id":"themes/pure/layout/archive.ejs","hash":"ded5d953b35666e30f4c6e48e2d2c62af8d95ebf","modified":1532976952000},{"_id":"themes/pure/layout/books.ejs","hash":"6c64719cd7071b5319b01339aa524fdaab391385","modified":1532976952000},{"_id":"themes/pure/layout/categories.ejs","hash":"2084974ba68f799216a8b216752f7fc87c693cc0","modified":1532976952000},{"_id":"themes/pure/layout/category.ejs","hash":"68632e8ac45088a929ca82b6cca8ba60323d6aac","modified":1532976952000},{"_id":"themes/pure/layout/index.ejs","hash":"07825d8d8b21eb7b694f5585567b9df5c5a91a60","modified":1532976952000},{"_id":"themes/pure/layout/layout.ejs","hash":"0438b1e88fcf2c2da67283ef84bdf83264448f8f","modified":1533810404000},{"_id":"themes/pure/layout/links.ejs","hash":"77c5d1561e2c606c5b3bb39610133d84324074df","modified":1532976952000},{"_id":"themes/pure/layout/page.ejs","hash":"5c27475c176627e6e2e6a16172eb6980e56bcaff","modified":1532976952000},{"_id":"themes/pure/layout/post.ejs","hash":"5c27475c176627e6e2e6a16172eb6980e56bcaff","modified":1532976952000},{"_id":"themes/pure/layout/repository.ejs","hash":"fe4b3e051a8b0debe9ee22c2cc2cc935d92ee23f","modified":1532976952000},{"_id":"themes/pure/layout/tag.ejs","hash":"6e4e6660cf58beb3e5e2e52b59c51393e4796c36","modified":1532976952000},{"_id":"themes/pure/layout/tags.ejs","hash":"4c0b797a45cf238be367932927edc88599aa3255","modified":1532976952000},{"_id":"themes/pure/scripts/thumbnail.js","hash":"e667a611f9baac270281b765832020d50bf8fb7f","modified":1532976952000},{"_id":"themes/pure/source/favicon.png","hash":"89875d3b018552e396fc5f0bd8ff5d9f5d4a5d71","modified":1532976952000},{"_id":"source/images/ngrok2.png","hash":"9684c2fdeda517e4e6af209bb545adb8dcf9cbf9","modified":1523100902000},{"_id":"source/images/home.jpg","hash":"cf792ead5fbd7a5f308b8cb94df77451b7b5d9cf","modified":1523261684000},{"_id":"themes/pure/screenshot/pure-theme-black.png","hash":"10b40f398af7eb7e8ba2bf2f2a959d8779fc1fe1","modified":1532976952000},{"_id":"themes/pure/screenshot/pure-theme-blue.png","hash":"6146890a68d5ea9d343c48d50151ddd5a2a1872c","modified":1532976952000},{"_id":"themes/pure/screenshot/pure-theme-green.png","hash":"12ec0c6033cb2762839fdf75434bbb4fbf946022","modified":1532976952000},{"_id":"themes/pure/screenshot/pure-theme-purple.png","hash":"9855d2eb0acd23370209354f232471df8f4f72e2","modified":1532976952000},{"_id":"themes/pure/screenshot/pure.png","hash":"8f4cfd8d7edfa4fbffdf375291302d9807f5cc1c","modified":1532976952000},{"_id":"themes/pure/_source/404/index.md","hash":"bd8d432cef40ea915d45e4df1eda43100851efeb","modified":1533882857000},{"_id":"themes/pure/_source/_data/gallery.yml","hash":"e2b3fad87be3d1cfde1effa655d39678ee90907e","modified":1532976952000},{"_id":"themes/pure/_source/_data/links.yml","hash":"aa443a4508550820c77c2a4f6abff1d38ad85054","modified":1532976952000},{"_id":"themes/pure/_source/about/index.md","hash":"8adde614cfdefeb3ca2708e643812261f0633f2a","modified":1533808784000},{"_id":"themes/pure/_source/books/index.md","hash":"cf4163959c23244059cbbbc1c0fe379cc3b2cb73","modified":1532976952000},{"_id":"themes/pure/_source/links/index.md","hash":"febcf87eb0ab3c5080578275d25f3970bba39625","modified":1532976952000},{"_id":"themes/pure/_source/categories/index.md","hash":"a9f2d6661e1ed09556ebf1136ac5c82b3f1022d6","modified":1533809566000},{"_id":"themes/pure/_source/repository/index.md","hash":"ed0e082c30f233dd5c140d188f1e4bce44bdbf79","modified":1532976952000},{"_id":"themes/pure/_source/tags/index.md","hash":"42e9c904ea63b0a7dd4033e2e8f153225bc5cda5","modified":1532976952000},{"_id":"themes/pure/layout/_common/footer.ejs","hash":"a2e302468c45f88375ced872acc5776646c17c4b","modified":1533883270000},{"_id":"themes/pure/layout/_common/head.ejs","hash":"b8373f4250170510640d7aa0ee82b9d7b9328672","modified":1532976952000},{"_id":"themes/pure/layout/_common/header.ejs","hash":"3d739d1e2b2991927c08ec222db123830a44a519","modified":1532976952000},{"_id":"themes/pure/layout/_common/plugin.ejs","hash":"c5decee89b55b9d40bc6a000e0a34b0a016ea08b","modified":1532976952000},{"_id":"themes/pure/layout/_common/script.ejs","hash":"5963fdc39a925c6961c7c360776f09be7ba81c43","modified":1532976952000},{"_id":"themes/pure/layout/_common/social.ejs","hash":"a35a2610e9da762df96587b76b51470507a88cad","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive-book.ejs","hash":"420dd18d8ea730065d20fee2bf7a7a9879a847cb","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive-category.ejs","hash":"9c364fd6b5172890784141802f5f466241d233fd","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive-link.ejs","hash":"fe4d9bf526d8176683cea89b8561ced571374db0","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive-list.ejs","hash":"c66c86d6a6a90e00494c380603426fc0f4006311","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive-post.ejs","hash":"13039fec017332029122ef99901755fcecbfc8ea","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive-repository.ejs","hash":"e39dc762d9fe238cede462532e40eaa3d8651122","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive-tag.ejs","hash":"5de90244c3cedad531cccc03c40e5f9a3aef3c61","modified":1532976952000},{"_id":"themes/pure/layout/_partial/archive.ejs","hash":"4d6793f50d41fbd47dc50aa36b24d496006bba6c","modified":1532976952000},{"_id":"themes/pure/layout/_partial/article-about.ejs","hash":"7b80319daeb63401d1745b81cd9a6d1d21a4fb60","modified":1532976952000},{"_id":"themes/pure/layout/_partial/article.ejs","hash":"11b36cdc807ec20470828385b4a590ffbf7ae1d9","modified":1532976952000},{"_id":"themes/pure/layout/_partial/item-post.ejs","hash":"9f755b0da1ea928dece32c2050d8a04b3a9fb13b","modified":1532976952000},{"_id":"themes/pure/layout/_partial/pagination.ejs","hash":"ce1492c39a9d73c6dbcc3993e705a2526bbab79b","modified":1532976952000},{"_id":"themes/pure/layout/_partial/sidebar-about.ejs","hash":"e10ea0176ba87e64888234bafedc01c92544352c","modified":1532976952000},{"_id":"themes/pure/layout/_partial/sidebar.ejs","hash":"2aa8a9f90838e7c105e75e6d3d03cbf860bb1239","modified":1532976952000},{"_id":"themes/pure/layout/_partial/sidebar-toc.ejs","hash":"152538ceceb0fdef65c46470ebf0189f7b891c5b","modified":1532976952000},{"_id":"themes/pure/layout/_script/douban.ejs","hash":"143087db0573772b0bdaf7f93312553158942ec7","modified":1532976952000},{"_id":"themes/pure/layout/_script/mathjax.ejs","hash":"f618393ab971b2faa80d541f2e6a553d9ace9816","modified":1532976952000},{"_id":"themes/pure/layout/_script/pv.ejs","hash":"2cc8fa015979b0ac2270faac0f0249577517fd63","modified":1532976952000},{"_id":"themes/pure/layout/_script/repository.ejs","hash":"234e6a9d8b129dc19e916cb9f927a27b04758180","modified":1532976952000},{"_id":"themes/pure/layout/_search/baidu.ejs","hash":"67aab280a3ea34429f086cc5c3de7de17727c567","modified":1532976952000},{"_id":"themes/pure/layout/_search/index-mobile.ejs","hash":"c726e234c0166da69fdfbd3dd613a5eaf4c80258","modified":1532976952000},{"_id":"themes/pure/layout/_search/index.ejs","hash":"f8d5a9c3f777250f5fb6512bba585307f784d5cd","modified":1532976952000},{"_id":"themes/pure/layout/_search/insight.ejs","hash":"4af3e92ef98bedba9680d45699cb04dde4640536","modified":1532976952000},{"_id":"themes/pure/layout/_search/swiftype.ejs","hash":"4baeca36e410181300ae7d47ba1fb4755bcfcff0","modified":1532976952000},{"_id":"themes/pure/layout/_widget/archive.ejs","hash":"af8ad7f62877764b75d5272d9d899fd6c8e3845c","modified":1532976952000},{"_id":"themes/pure/layout/_widget/board.ejs","hash":"acd27451be52703e670ce0b313f2da6fa24071e4","modified":1532976952000},{"_id":"themes/pure/layout/_widget/category.ejs","hash":"331b7642a0f58b9088b937436ab39076a4c5dd7e","modified":1532976952000},{"_id":"themes/pure/layout/_widget/recent_posts.ejs","hash":"8942d60311797a591ba2d157c5cdd23e85ceb694","modified":1532976952000},{"_id":"themes/pure/layout/_widget/tag.ejs","hash":"487628925da5fcac91463cdad3d9e55d071bd5ed","modified":1532976952000},{"_id":"themes/pure/layout/_widget/tagcloud.ejs","hash":"3291108e5411c48b2c5b3e17adace6ffa90d1c29","modified":1532976952000},{"_id":"themes/pure/source/fonts/README.md","hash":"c5772b99ad81291fb137b330813f866bdceea0a3","modified":1532976952000},{"_id":"themes/pure/source/fonts/iconfont.eot","hash":"6819d9bb643bdeafc17bfecb0746ae641b018fdf","modified":1532976952000},{"_id":"themes/pure/source/fonts/iconfont.ttf","hash":"9b8837f9f79cf6ab794736301d0665345183a20c","modified":1532976952000},{"_id":"themes/pure/source/fonts/iconfont.woff","hash":"78d29194287b8885d25212048c4f787705212a6e","modified":1532976952000},{"_id":"themes/pure/source/images/avatar.jpg","hash":"1910f1282ef83d62112a36f3c8e73b9f3a6436de","modified":1533883843000},{"_id":"themes/pure/source/images/thumb-default.png","hash":"e8403b97ed9251f9f5207765b0ce796c5000b4ba","modified":1532976952000},{"_id":"themes/pure/source/js/application.js","hash":"f36f3451604f8a808e784faf49fc201fac43a95a","modified":1532976952000},{"_id":"themes/pure/source/js/application.min.js","hash":"d18a1f4e9cdae00000a2224632db261d62f1db0d","modified":1532976952000},{"_id":"themes/pure/source/js/insight.js","hash":"298e8ca42517984bd26f34caa4c45560b0e909ad","modified":1532976952000},{"_id":"source/images/ngrok3.jpg","hash":"32e927e5ff1b57b63c05e6776eb5356080bfd712","modified":1523101470000},{"_id":"themes/pure/source/js/jquery.min.js","hash":"5a9dcfbef655a2668e78baebeaa8dc6f41d8dabb","modified":1532976952000},{"_id":"themes/pure/source/js/plugin.js","hash":"a8524d42b8621bfaa06602a163c6a1f82702b91d","modified":1532976952000},{"_id":"themes/pure/source/js/plugin.min.js","hash":"07fe34638f9832702c5f81d8583c5e4e8b3d9659","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/category.ejs","hash":"fcee6b4aef8b6c4627831ff8dbb2d73478511426","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/comment.ejs","hash":"807f46a16e31be965b36e81923b4882f668a2a99","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/copyright.ejs","hash":"6692e9a906a5066d41dca9c52d6a3380383aac0c","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/date.ejs","hash":"7d4979652998abf92a64bfae8157b70d6e514057","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/donate.ejs","hash":"a251dc34d660601a2e8b7d98b3bfe2b9023dbbce","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/gallery.ejs","hash":"3d9d81a3c693ff2378ef06ddb6810254e509de5b","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/nav.ejs","hash":"95eabc0fe4033ec61b240a16eeaf7dc62a9e3da1","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/pv.ejs","hash":"ec3ccf322432afc2761f860c5a3000ac34d46e4c","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/tag.ejs","hash":"39f53ead07f75c181a7ba93e586dd1b8171620f1","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/thumbnail.ejs","hash":"080d5c5f3e95accf51893a7092695fe32d34a087","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/title.ejs","hash":"2f275739b6f1193c123646a5a31f37d48644c667","modified":1532976952000},{"_id":"themes/pure/layout/_partial/post/wordcount.ejs","hash":"bd06c4c8449ed96aabf655fe1ae3be1f0707b81e","modified":1532976952000},{"_id":"themes/pure/layout/_script/_analytics/google-analytics.ejs","hash":"54f1dc9375cbdb65464e0ac1b58847aa5e8bc6a5","modified":1532976952000},{"_id":"themes/pure/layout/_script/_analytics/baidu-analytics.ejs","hash":"f314be7860c1d5930f1600d010e3120ba5c85325","modified":1532976952000},{"_id":"themes/pure/layout/_script/_analytics/tencent-analytics.ejs","hash":"dee9c2adc0df37c7e1edb617ba92983eee3f3c8e","modified":1532976952000},{"_id":"themes/pure/layout/_script/_analytics/script.ejs","hash":"c5aa37346d973437d0a693f8dd345a0b87edfe6f","modified":1532976952000},{"_id":"themes/pure/layout/_script/_comment/disqus.ejs","hash":"b30ced7d02e63c64227139aa4b99286400d7bcea","modified":1532976952000},{"_id":"themes/pure/layout/_script/_comment/gitment.ejs","hash":"09e66c8bfd1cc0507a0da619f56101423b9e653a","modified":1532976952000},{"_id":"themes/pure/layout/_script/_comment/livere.ejs","hash":"c951b2fac4e143c0a2fb4fd3369307f23cfe2687","modified":1532976952000},{"_id":"themes/pure/layout/_script/_comment/script.ejs","hash":"fd5f5ec44076e99792e1df8f0893f84ebb2cd0bb","modified":1532976952000},{"_id":"themes/pure/layout/_script/_comment/valine.ejs","hash":"43aa1dc6a2799d44c7ca87dddafb4d0f0c9754bb","modified":1532976952000},{"_id":"themes/pure/layout/_script/_comment/youyan.ejs","hash":"92d897be24e8c520c5a3f8903c542892e2b30a9a","modified":1532976952000},{"_id":"themes/pure/layout/_script/_search/baidu.ejs","hash":"9b60ffa2e2725a993e9cecfb81ddedd9b9361011","modified":1532976952000},{"_id":"themes/pure/layout/_script/_search/insight.ejs","hash":"3543c11d060feaf9381b5d87564b01ffef0e0a59","modified":1532976952000},{"_id":"themes/pure/source/css/style.css","hash":"fb86e8eaadf07f92a2e462ba01213c727fa4ec87","modified":1532976952000},{"_id":"themes/pure/source/css/style.min.css","hash":"bab3e261659c9e18b2b2a26743f9e0577cc0c1f6","modified":1532976952000},{"_id":"themes/pure/source/fonts/iconfont.svg","hash":"25929e6e74f7027acd1f6467a67e95b153bcd8d5","modified":1532976952000},{"_id":"themes/pure/source/images/donate/alipayimg.png","hash":"0f6ac674313304d6c4e1b3bd3e51bdceeb97b1d8","modified":1533804439000},{"_id":"themes/pure/source/images/donate/wechatpayimg.png","hash":"0f6ac674313304d6c4e1b3bd3e51bdceeb97b1d8","modified":1533804439000},{"_id":"themes/pure/source/images/favatar/chuangzaoshi-logo.png","hash":"7fa5734072050952159a02d330bbc008b5a99122","modified":1532976952000},{"_id":"themes/pure/source/images/favatar/idesign-logo.png","hash":"6b150a2dbb9912b7a7662255c27e4d4baaecee71","modified":1532976952000},{"_id":"themes/pure/source/js/plugin.js.map","hash":"1730c0cc660f863120aca0a439d7264e2e245fc5","modified":1532976952000},{"_id":"source/images/pdf.jpg","hash":"d86852f8c83ae9e0e11d0ec157f2e60b66afe8a0","modified":1526545389000},{"_id":"themes/pure/screenshot/pure.psd","hash":"a31cea40b45bdc31f051fca2f1e2f4ecbaee1a94","modified":1532976952000},{"_id":"public/archives/index.html","hash":"f583396031a82abde0c684fb8e0e2b7d894204b3","modified":1533883953771},{"_id":"public/archives/2018/index.html","hash":"e2f957a162a61c5c93e01d973ff30f5fc8035526","modified":1533883953771},{"_id":"public/archives/2018/04/index.html","hash":"1cde88e0dcc306030c2d05cde1911c7bafa1f00d","modified":1533883953771},{"_id":"public/archives/2018/05/index.html","hash":"62848aec34e5c23f3b0f022019b0245b51a97a4b","modified":1533883953772},{"_id":"public/atom.xml","hash":"0160ded49405b05382db31e552695049bbebf919","modified":1533882924992},{"_id":"public/content.json","hash":"c14b6aceed4f261ac00e4a4d9d87e1753b897db9","modified":1533883951439},{"_id":"public/sitemap.xml","hash":"2d520e6a067af0215ba9495f76d408fcfc3ca6ac","modified":1533883953036},{"_id":"public/2018/05/18/预览PDF文件/index.html","hash":"554b961f915314d44591eee4394b2a7f5b3e01b4","modified":1533883953772},{"_id":"public/2018/05/17/CSS实现文字滚动，类似公告展示/index.html","hash":"70eb0471f7d8943cfcf5a16742db2403bea9dc4e","modified":1533883953772},{"_id":"public/2018/05/17/前端预览文件/index.html","hash":"a8f344d476d78c976c83980ee584e08ae4de6bb5","modified":1533883953772},{"_id":"public/2018/04/19/wx_sdk/index.html","hash":"42a4cce9cfa0371c464d02fe45e751c2cc4ef359","modified":1533883953772},{"_id":"public/2018/04/09/图片压缩/index.html","hash":"61539199722fb5a36816c8e5ce244f7eccca7152","modified":1533883953772},{"_id":"public/2018/04/09/ngrok/index.html","hash":"b1c3161239cafd146667f630325148707854d873","modified":1533883953772},{"_id":"public/index.html","hash":"35ec1d75b612d6720398574a5fe7de1215386119","modified":1533883953772},{"_id":"public/archives/2018/07/index.html","hash":"0e1b50df9952e1605e65474a3d71c08321365957","modified":1533808042577},{"_id":"public/2018/07/19/与小程序间的相爱相杀/index.html","hash":"906e28c32984a50196aa2c809671a850b4e493d0","modified":1533808042577},{"_id":"public/images/avatar.jpeg","hash":"79c349c84e1c491712804f07214c06fc045d14a3","modified":1533803458190},{"_id":"public/images/ngrok1.png","hash":"afca08b310edc1ac853bc9c8a04736e0e3fc6fbc","modified":1533803458190},{"_id":"public/favicon.png","hash":"89875d3b018552e396fc5f0bd8ff5d9f5d4a5d71","modified":1533803458190},{"_id":"public/fonts/iconfont.eot","hash":"6819d9bb643bdeafc17bfecb0746ae641b018fdf","modified":1533803458190},{"_id":"public/fonts/iconfont.ttf","hash":"9b8837f9f79cf6ab794736301d0665345183a20c","modified":1533803458190},{"_id":"public/fonts/iconfont.woff","hash":"78d29194287b8885d25212048c4f787705212a6e","modified":1533803458190},{"_id":"public/images/avatar.jpg","hash":"1910f1282ef83d62112a36f3c8e73b9f3a6436de","modified":1533883953784},{"_id":"public/images/thumb-default.png","hash":"e8403b97ed9251f9f5207765b0ce796c5000b4ba","modified":1533803458190},{"_id":"public/images/donate/alipayimg.png","hash":"9562f23f2eb57841c65dc769b6cc43a2cf0efa94","modified":1533803458190},{"_id":"public/images/donate/wechatpayimg.png","hash":"c0844d9a633696cb00ae64fde06f0f924f63b596","modified":1533803458190},{"_id":"public/images/favatar/chuangzaoshi-logo.png","hash":"7fa5734072050952159a02d330bbc008b5a99122","modified":1533803458191},{"_id":"public/images/favatar/idesign-logo.png","hash":"6b150a2dbb9912b7a7662255c27e4d4baaecee71","modified":1533803458191},{"_id":"public/images/ngrok2.png","hash":"9684c2fdeda517e4e6af209bb545adb8dcf9cbf9","modified":1533803458196},{"_id":"public/images/home.jpg","hash":"cf792ead5fbd7a5f308b8cb94df77451b7b5d9cf","modified":1533803458196},{"_id":"public/fonts/README.html","hash":"43b6265aeccff3f9d495e2b44d07b249a2197bd7","modified":1533803458207},{"_id":"public/js/application.js","hash":"f36f3451604f8a808e784faf49fc201fac43a95a","modified":1533803458207},{"_id":"public/js/application.min.js","hash":"d18a1f4e9cdae00000a2224632db261d62f1db0d","modified":1533803458207},{"_id":"public/js/insight.js","hash":"298e8ca42517984bd26f34caa4c45560b0e909ad","modified":1533803458207},{"_id":"public/js/jquery.min.js","hash":"5a9dcfbef655a2668e78baebeaa8dc6f41d8dabb","modified":1533803458207},{"_id":"public/js/plugin.js","hash":"a8524d42b8621bfaa06602a163c6a1f82702b91d","modified":1533803458208},{"_id":"public/js/plugin.min.js","hash":"07fe34638f9832702c5f81d8583c5e4e8b3d9659","modified":1533803458208},{"_id":"public/css/style.css","hash":"fb86e8eaadf07f92a2e462ba01213c727fa4ec87","modified":1533803458208},{"_id":"public/css/style.min.css","hash":"bab3e261659c9e18b2b2a26743f9e0577cc0c1f6","modified":1533803458208},{"_id":"public/fonts/iconfont.svg","hash":"25929e6e74f7027acd1f6467a67e95b153bcd8d5","modified":1533803458208},{"_id":"public/js/plugin.js.map","hash":"1730c0cc660f863120aca0a439d7264e2e245fc5","modified":1533803458208},{"_id":"public/images/ngrok3.jpg","hash":"32e927e5ff1b57b63c05e6776eb5356080bfd712","modified":1533803458211},{"_id":"public/images/pdf.jpg","hash":"d86852f8c83ae9e0e11d0ec157f2e60b66afe8a0","modified":1533803458221},{"_id":"themes/pure/source/images/avatar.jpeg","hash":"d7e849ac4e0e947ad2c08d24a2183d8039f24a7b","modified":1510111077000},{"_id":"themes/pure/source/images/donate/wechatpayimg.jpeg","hash":"6ae891e3a5af360f73b42011bcfb8bbffca90d8f","modified":1533804439000},{"_id":"themes/pure/source/images/donate/alipayimg.jpeg","hash":"6ae891e3a5af360f73b42011bcfb8bbffca90d8f","modified":1533804439000},{"_id":"source/repository/index.md","hash":"ed0e082c30f233dd5c140d188f1e4bce44bdbf79","modified":1532976952000},{"_id":"public/baidusitemap.xml","hash":"42dd45f7b537fe73293e840b65fde9a7b62f9963","modified":1533883951275},{"_id":"public/repository/index.html","hash":"de56f0edd98ca4106ecfc24f2f1976fbd1c2637e","modified":1533883953771},{"_id":"public/images/donate/alipayimg.jpeg","hash":"6ae891e3a5af360f73b42011bcfb8bbffca90d8f","modified":1533808042585},{"_id":"source/about/index.md","hash":"da1b04c618483f8a0704ab9d00d306be313f7673","modified":1533809412000},{"_id":"source/404/index.md","hash":"bd8d432cef40ea915d45e4df1eda43100851efeb","modified":1533882898000},{"_id":"source/_data/links.yml","hash":"aa443a4508550820c77c2a4f6abff1d38ad85054","modified":1532976952000},{"_id":"source/books/index.md","hash":"cf4163959c23244059cbbbc1c0fe379cc3b2cb73","modified":1532976952000},{"_id":"source/categories/index.md","hash":"5d2a4f103d27bebbe3eef1604649d0f5c6d86ac6","modified":1532976952000},{"_id":"source/links/index.md","hash":"febcf87eb0ab3c5080578275d25f3970bba39625","modified":1532976952000},{"_id":"source/tags/index.md","hash":"eb20aa81b7167a31e6db6859f22b3546f3e65d6c","modified":1533810102000},{"_id":"source/_data/gallery.yml","hash":"e2b3fad87be3d1cfde1effa655d39678ee90907e","modified":1532976952000},{"_id":"public/404.html","hash":"f674c96d7e85b19cf79d7ba1044538d9dbb75cab","modified":1533882926390},{"_id":"public/books/index.html","hash":"00a141d0e3f576957b96649bb79e92138bfb1248","modified":1533883953771},{"_id":"public/categories/index.html","hash":"f5a608e2b6d033cc27af441f6cad133f50071baf","modified":1533883953771},{"_id":"public/links/index.html","hash":"c12fad72f83106e0b0a39b597367833945201205","modified":1533883953771},{"_id":"public/tags/index.html","hash":"039cafa546ccc7a1e5c2389d3687a174a9fa20a0","modified":1533883953771},{"_id":"public/about/index.html","hash":"cfa48fb7a723d72e033f6492db8b678c3357c11e","modified":1533883953771},{"_id":"public/archives/2018/08/index.html","hash":"db9b0fc83ad3869fa69d72e67fe135da563a42f5","modified":1533883953772},{"_id":"public/2018/08/10/与小程序间的相爱相杀/index.html","hash":"baf90f9c0d8d3805bacaabc6d3f1c71a7cdcb3c4","modified":1533883953772}],"Category":[],"Data":[{"_id":"links","data":{"创造狮":{"link":"http://chuangzaoshi.com/","avatar":"/images/favatar/chuangzaoshi-logo.png","desc":"为创意工作者而设计"},"腾讯设计导航":{"link":"http://idesign.qq.com/","avatar":"/images/favatar/idesign-logo.png","desc":"网罗全网高逼格的设计站点"}}},{"_id":"gallery","data":{"Name":{"full_link":"http://example.com/full-image.png","thumb_link":"http://example.com/thumb-image.png","descr":"这是一个描述"}}}],"Page":[{"title":"书单","layout":"books","comments":0,"sidebar":"none","_content":"","source":"books/index.md","raw":"---\ntitle: 书单\nlayout: books\ncomments: false\nsidebar: none\n---","date":"2018-08-09T09:54:26.000Z","updated":"2018-07-30T18:55:52.000Z","path":"books/index.html","_id":"cjkmdyiy60002ywq31x4h4fqz","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"分类","layout":"categories","comments":0,"_content":"","source":"categories/index.md","raw":"---\ntitle: 分类\nlayout: categories\ncomments: false\n---\n","date":"2018-08-09T09:54:26.000Z","updated":"2018-07-30T18:55:52.000Z","path":"categories/index.html","_id":"cjkmdyiy70003ywq3yen2y5y8","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"友情链接","layout":"links","comments":1,"sidebar":"none","_content":"","source":"links/index.md","raw":"---\ntitle: 友情链接\nlayout: links\ncomments: true\nsidebar: none\n---","date":"2018-08-09T09:54:26.000Z","updated":"2018-07-30T18:55:52.000Z","path":"links/index.html","_id":"cjkmdyiy80004ywq3cttbwbj6","content":"","site":{"data":{}},"excerpt":"","more":""},{"title":"标签","layout":"tags","comments":0,"_content":"","source":"tags/index.md","raw":"---\ntitle: 标签\nlayout: tags\ncomments: false\n---","date":"2018-08-09T10:21:42.000Z","updated":"2018-08-09T10:21:42.000Z","path":"tags/index.html","_id":"cjkmdyiy90005ywq3kxea08f0","content":"<!-- build time:Thu Aug 09 2018 20:08:14 GMT+0800 (CST) --><!-- rebuild by neat -->","site":{"data":{"links":{"创造狮":{"link":"http://chuangzaoshi.com/","avatar":"/images/favatar/chuangzaoshi-logo.png","desc":"为创意工作者而设计"},"腾讯设计导航":{"link":"http://idesign.qq.com/","avatar":"/images/favatar/idesign-logo.png","desc":"网罗全网高逼格的设计站点"}},"gallery":{"Name":{"full_link":"http://example.com/full-image.png","thumb_link":"http://example.com/thumb-image.png","descr":"这是一个描述"}}}},"excerpt":"","more":"<!-- build time:Thu Aug 09 2018 20:08:14 GMT+0800 (CST) --><!-- rebuild by neat -->"},{"title":"关于","description":null,"layout":"about","comments":0,"sidebar":"custom","_content":"致力于小程序、微信公众号与web前端开发。喜欢新事物，关注前端动态，对新的技术有追求；努力学会做一个\"懒人\"。\n\n```json\n{\n  name: 'lishaohua'\n  age: 24,\n  gender: '男',\n  profession: 'Web Developer',\n  experience: '3年',\n  address: '北京市朝阳区',\n  education: '本科',\n  github: 'https://github.com/Andrew-project',\n  blog: 'www.lookpeakfans.xyz',\n  email: 'lsh294753@gmail.com',\n  description: '致力于小程序、微信公众号与web前端开发',\n\n  skills: [\n    ['Html', 'Javascript', 'CSS', 'ES6', 'Node'],\n    ['Less','Sass'],\n    ['Angular', 'Ionic'],\n    ['小程序', '微信公众号'],\n    ['Vue'],\n    ['Git'],\n    ['NG-ZORRO', 'Bootstrap']\n  ],\n\n  devTools: [\n    ['Visual Studio Code', 'Webstorm'],\n    ['Chrome DevTools'],\n  ]  \n}\n\n```","source":"about/index.md","raw":"---\ntitle: 关于\ndescription: \nlayout: about\ncomments: false\nsidebar: custom\n---\n致力于小程序、微信公众号与web前端开发。喜欢新事物，关注前端动态，对新的技术有追求；努力学会做一个\"懒人\"。\n\n```json\n{\n  name: 'lishaohua'\n  age: 24,\n  gender: '男',\n  profession: 'Web Developer',\n  experience: '3年',\n  address: '北京市朝阳区',\n  education: '本科',\n  github: 'https://github.com/Andrew-project',\n  blog: 'www.lookpeakfans.xyz',\n  email: 'lsh294753@gmail.com',\n  description: '致力于小程序、微信公众号与web前端开发',\n\n  skills: [\n    ['Html', 'Javascript', 'CSS', 'ES6', 'Node'],\n    ['Less','Sass'],\n    ['Angular', 'Ionic'],\n    ['小程序', '微信公众号'],\n    ['Vue'],\n    ['Git'],\n    ['NG-ZORRO', 'Bootstrap']\n  ],\n\n  devTools: [\n    ['Visual Studio Code', 'Webstorm'],\n    ['Chrome DevTools'],\n  ]  \n}\n\n```","date":"2018-08-09T10:10:12.000Z","updated":"2018-08-09T10:10:12.000Z","path":"about/index.html","_id":"cjkmdyiya0006ywq3stk2xr2z","content":"<!-- build time:Thu Aug 09 2018 20:08:14 GMT+0800 (CST) --><p>致力于小程序、微信公众号与web前端开发。喜欢新事物，关注前端动态，对新的技术有追求；努力学会做一个”懒人”。</p><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  name: 'lishaohua'</span><br><span class=\"line\">  age: 24,</span><br><span class=\"line\">  gender: '男',</span><br><span class=\"line\">  profession: 'Web Developer',</span><br><span class=\"line\">  experience: '3年',</span><br><span class=\"line\">  address: '北京市朝阳区',</span><br><span class=\"line\">  education: '本科',</span><br><span class=\"line\">  github: 'https://github.com/Andrew-project',</span><br><span class=\"line\">  blog: 'www.lookpeakfans.xyz',</span><br><span class=\"line\">  email: 'lsh294753@gmail.com',</span><br><span class=\"line\">  description: '致力于小程序、微信公众号与web前端开发',</span><br><span class=\"line\"></span><br><span class=\"line\">  skills: [</span><br><span class=\"line\">    ['Html', 'Javascript', 'CSS', 'ES6', 'Node'],</span><br><span class=\"line\">    ['Less','Sass'],</span><br><span class=\"line\">    ['Angular', 'Ionic'],</span><br><span class=\"line\">    ['小程序', '微信公众号'],</span><br><span class=\"line\">    ['Vue'],</span><br><span class=\"line\">    ['Git'],</span><br><span class=\"line\">    ['NG-ZORRO', 'Bootstrap']</span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  devTools: [</span><br><span class=\"line\">    ['Visual Studio Code', 'Webstorm'],</span><br><span class=\"line\">    ['Chrome DevTools'],</span><br><span class=\"line\">  ]  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->","site":{"data":{"links":{"创造狮":{"link":"http://chuangzaoshi.com/","avatar":"/images/favatar/chuangzaoshi-logo.png","desc":"为创意工作者而设计"},"腾讯设计导航":{"link":"http://idesign.qq.com/","avatar":"/images/favatar/idesign-logo.png","desc":"网罗全网高逼格的设计站点"}},"gallery":{"Name":{"full_link":"http://example.com/full-image.png","thumb_link":"http://example.com/thumb-image.png","descr":"这是一个描述"}}}},"excerpt":"","more":"<!-- build time:Thu Aug 09 2018 20:08:14 GMT+0800 (CST) --><p>致力于小程序、微信公众号与web前端开发。喜欢新事物，关注前端动态，对新的技术有追求；努力学会做一个”懒人”。</p><figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">  name: 'lishaohua'</span><br><span class=\"line\">  age: 24,</span><br><span class=\"line\">  gender: '男',</span><br><span class=\"line\">  profession: 'Web Developer',</span><br><span class=\"line\">  experience: '3年',</span><br><span class=\"line\">  address: '北京市朝阳区',</span><br><span class=\"line\">  education: '本科',</span><br><span class=\"line\">  github: 'https://github.com/Andrew-project',</span><br><span class=\"line\">  blog: 'www.lookpeakfans.xyz',</span><br><span class=\"line\">  email: 'lsh294753@gmail.com',</span><br><span class=\"line\">  description: '致力于小程序、微信公众号与web前端开发',</span><br><span class=\"line\"></span><br><span class=\"line\">  skills: [</span><br><span class=\"line\">    ['Html', 'Javascript', 'CSS', 'ES6', 'Node'],</span><br><span class=\"line\">    ['Less','Sass'],</span><br><span class=\"line\">    ['Angular', 'Ionic'],</span><br><span class=\"line\">    ['小程序', '微信公众号'],</span><br><span class=\"line\">    ['Vue'],</span><br><span class=\"line\">    ['Git'],</span><br><span class=\"line\">    ['NG-ZORRO', 'Bootstrap']</span><br><span class=\"line\">  ],</span><br><span class=\"line\"></span><br><span class=\"line\">  devTools: [</span><br><span class=\"line\">    ['Visual Studio Code', 'Webstorm'],</span><br><span class=\"line\">    ['Chrome DevTools'],</span><br><span class=\"line\">  ]  </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure><!-- rebuild by neat -->"},{"title":"Repositories","layout":"repository","comments":0,"sidebar":"none","_content":"","source":"repository/index.md","raw":"---\ntitle: Repositories\nlayout: repository\ncomments: false\nsidebar: none\n---\n","date":"2018-08-09T09:54:26.000Z","updated":"2018-07-30T18:55:52.000Z","path":"repository/index.html","_id":"cjkmdyiyd0007ywq3ykj7o1hh","content":"","site":{"data":{}},"excerpt":"","more":""}],"Post":[{"title":"与小程序的相爱相杀","_content":"\n#### 问题1：自定义组件时，canvas组件无法注册\n\n```js\nready(){\n    const ctx = wx.createCanvasContext('back-canvas')\n    ctx.setFillStyle('red')\n    ctx.fillRect(10, 10, 150, 75)\n    ctx.draw();\n  }\n```\n```html\n<canvas class='canvas' canvas-id=\"back-canvas\" style=\"width:200px;height:200px;\"></canvas>\n```\n\n解决办法：createCanvasContext方法是有两个参数的，在page页面默认传了一个this,组件里面 需要手动传this\n```js\nconst ctx = wx.createCanvasContext('myCanvas',this);\n```\n     \n#### 问题2：使用image标签的binderror方法，避免图片URL无效\n#### 问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\n#### 问题4：选择拍照功能和相册选择图片，原有的页面会onHide\n#### 问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\n#### 问题6：wx.createInnerAudioContext()播放语音先try销毁再新建\n#### 问题7：小程序console过多报错: [转](https://blog.csdn.net/rolan1993/article/details/80431569)\n```\n Uncaught TypeError: Converting circular structure to JSON\n \n 解决办法： 注释掉console.log\n```\n#### 问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中...\n#### 问题9：wxs文件解决wxml中不能写计算逻辑问题\n#### 问题10：setData修改数组某一项值时可以不用全局赋值\n\n```\nvar price = 'goods['+index+'].price'\nthis.setData({\n    [price]:'changed data'\n})\n```\n#### 问题11：阿拉伯数字 会增大一行的font-size\n","source":"_posts/与小程序间的相爱相杀.md","raw":"---\ntitle: 与小程序的相爱相杀\n---\n\n#### 问题1：自定义组件时，canvas组件无法注册\n\n```js\nready(){\n    const ctx = wx.createCanvasContext('back-canvas')\n    ctx.setFillStyle('red')\n    ctx.fillRect(10, 10, 150, 75)\n    ctx.draw();\n  }\n```\n```html\n<canvas class='canvas' canvas-id=\"back-canvas\" style=\"width:200px;height:200px;\"></canvas>\n```\n\n解决办法：createCanvasContext方法是有两个参数的，在page页面默认传了一个this,组件里面 需要手动传this\n```js\nconst ctx = wx.createCanvasContext('myCanvas',this);\n```\n     \n#### 问题2：使用image标签的binderror方法，避免图片URL无效\n#### 问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\n#### 问题4：选择拍照功能和相册选择图片，原有的页面会onHide\n#### 问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\n#### 问题6：wx.createInnerAudioContext()播放语音先try销毁再新建\n#### 问题7：小程序console过多报错: [转](https://blog.csdn.net/rolan1993/article/details/80431569)\n```\n Uncaught TypeError: Converting circular structure to JSON\n \n 解决办法： 注释掉console.log\n```\n#### 问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中...\n#### 问题9：wxs文件解决wxml中不能写计算逻辑问题\n#### 问题10：setData修改数组某一项值时可以不用全局赋值\n\n```\nvar price = 'goods['+index+'].price'\nthis.setData({\n    [price]:'changed data'\n})\n```\n#### 问题11：阿拉伯数字 会增大一行的font-size\n","slug":"与小程序间的相爱相杀","published":1,"date":"2018-08-10T06:18:18.000Z","updated":"2018-08-10T06:18:18.000Z","_id":"cjkmaz64d0000fkq3ljgw3bdc","comments":1,"layout":"post","photos":[],"link":"","content":"<!-- build time:Fri Aug 10 2018 14:35:22 GMT+0800 (CST) --><h4 id=\"问题1：自定义组件时，canvas组件无法注册\"><a href=\"#问题1：自定义组件时，canvas组件无法注册\" class=\"headerlink\" title=\"问题1：自定义组件时，canvas组件无法注册\"></a>问题1：自定义组件时，canvas组件无法注册</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">ready()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'back-canvas'</span>)</span><br><span class=\"line\">    ctx.setFillStyle(<span class=\"string\">'red'</span>)</span><br><span class=\"line\">    ctx.fillRect(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">150</span>, <span class=\"number\">75</span>)</span><br><span class=\"line\">    ctx.draw();</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">class</span>=<span class=\"string\">'canvas'</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"back-canvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:200px;height:200px;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure><p>解决办法：createCanvasContext方法是有两个参数的，在page页面默认传了一个this,组件里面 需要手动传this<br></p><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'myCanvas'</span>,<span class=\"keyword\">this</span>);</span><br></pre></td></tr></table></figure><p></p><h4 id=\"问题2：使用image标签的binderror方法，避免图片URL无效\"><a href=\"#问题2：使用image标签的binderror方法，避免图片URL无效\" class=\"headerlink\" title=\"问题2：使用image标签的binderror方法，避免图片URL无效\"></a>问题2：使用image标签的binderror方法，避免图片URL无效</h4><h4 id=\"问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\"><a href=\"#问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\" class=\"headerlink\" title=\"问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\"></a>问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次</h4><h4 id=\"问题4：选择拍照功能和相册选择图片，原有的页面会onHide\"><a href=\"#问题4：选择拍照功能和相册选择图片，原有的页面会onHide\" class=\"headerlink\" title=\"问题4：选择拍照功能和相册选择图片，原有的页面会onHide\"></a>问题4：选择拍照功能和相册选择图片，原有的页面会onHide</h4><h4 id=\"问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\"><a href=\"#问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\" class=\"headerlink\" title=\"问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\"></a>问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom</h4><h4 id=\"问题6：wx-createInnerAudioContext-播放语音先try销毁再新建\"><a href=\"#问题6：wx-createInnerAudioContext-播放语音先try销毁再新建\" class=\"headerlink\" title=\"问题6：wx.createInnerAudioContext()播放语音先try销毁再新建\"></a>问题6：wx.createInnerAudioContext()播放语音先try销毁再新建</h4><h4 id=\"问题7：小程序console过多报错-转\"><a href=\"#问题7：小程序console过多报错-转\" class=\"headerlink\" title=\"问题7：小程序console过多报错: 转\"></a>问题7：小程序console过多报错: <a href=\"https://blog.csdn.net/rolan1993/article/details/80431569\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">转</a></h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">Uncaught TypeError: Converting circular structure to JSON</span><br><span class=\"line\"></span><br><span class=\"line\">解决办法： 注释掉console.log</span><br></pre></td></tr></table></figure><h4 id=\"问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…\"><a href=\"#问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…\" class=\"headerlink\" title=\"问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…\"></a>问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…</h4><h4 id=\"问题9：wxs文件解决wxml中不能写计算逻辑问题\"><a href=\"#问题9：wxs文件解决wxml中不能写计算逻辑问题\" class=\"headerlink\" title=\"问题9：wxs文件解决wxml中不能写计算逻辑问题\"></a>问题9：wxs文件解决wxml中不能写计算逻辑问题</h4><h4 id=\"问题10：setData修改数组某一项值时可以不用全局赋值\"><a href=\"#问题10：setData修改数组某一项值时可以不用全局赋值\" class=\"headerlink\" title=\"问题10：setData修改数组某一项值时可以不用全局赋值\"></a>问题10：setData修改数组某一项值时可以不用全局赋值</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">var price = &apos;goods[&apos;+index+&apos;].price&apos;</span><br><span class=\"line\">this.setData(&#123;</span><br><span class=\"line\">    [price]:&apos;changed data&apos;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h4 id=\"问题11：阿拉伯数字-会增大一行的font-size\"><a href=\"#问题11：阿拉伯数字-会增大一行的font-size\" class=\"headerlink\" title=\"问题11：阿拉伯数字 会增大一行的font-size\"></a>问题11：阿拉伯数字 会增大一行的font-size</h4><!-- rebuild by neat -->","site":{"data":{"links":{"创造狮":{"link":"http://chuangzaoshi.com/","avatar":"/images/favatar/chuangzaoshi-logo.png","desc":"为创意工作者而设计"},"腾讯设计导航":{"link":"http://idesign.qq.com/","avatar":"/images/favatar/idesign-logo.png","desc":"网罗全网高逼格的设计站点"}},"gallery":{"Name":{"full_link":"http://example.com/full-image.png","thumb_link":"http://example.com/thumb-image.png","descr":"这是一个描述"}}}},"excerpt":"","more":"<!-- build time:Fri Aug 10 2018 14:35:22 GMT+0800 (CST) --><h4 id=\"问题1：自定义组件时，canvas组件无法注册\"><a href=\"#问题1：自定义组件时，canvas组件无法注册\" class=\"headerlink\" title=\"问题1：自定义组件时，canvas组件无法注册\"></a>问题1：自定义组件时，canvas组件无法注册</h4><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">ready()&#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'back-canvas'</span>)</span><br><span class=\"line\">    ctx.setFillStyle(<span class=\"string\">'red'</span>)</span><br><span class=\"line\">    ctx.fillRect(<span class=\"number\">10</span>, <span class=\"number\">10</span>, <span class=\"number\">150</span>, <span class=\"number\">75</span>)</span><br><span class=\"line\">    ctx.draw();</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">class</span>=<span class=\"string\">'canvas'</span> <span class=\"attr\">canvas-id</span>=<span class=\"string\">\"back-canvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"width:200px;height:200px;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br></pre></td></tr></table></figure><p>解决办法：createCanvasContext方法是有两个参数的，在page页面默认传了一个this,组件里面 需要手动传this<br></p><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> ctx = wx.createCanvasContext(<span class=\"string\">'myCanvas'</span>,<span class=\"keyword\">this</span>);</span><br></pre></td></tr></table></figure><p></p><h4 id=\"问题2：使用image标签的binderror方法，避免图片URL无效\"><a href=\"#问题2：使用image标签的binderror方法，避免图片URL无效\" class=\"headerlink\" title=\"问题2：使用image标签的binderror方法，避免图片URL无效\"></a>问题2：使用image标签的binderror方法，避免图片URL无效</h4><h4 id=\"问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\"><a href=\"#问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\" class=\"headerlink\" title=\"问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次\"></a>问题3：生命周期onLoad只加载一次只是对页面不属于栈顶有效，如果页面属于栈顶，则页面onLoad会随页面加载多次</h4><h4 id=\"问题4：选择拍照功能和相册选择图片，原有的页面会onHide\"><a href=\"#问题4：选择拍照功能和相册选择图片，原有的页面会onHide\" class=\"headerlink\" title=\"问题4：选择拍照功能和相册选择图片，原有的页面会onHide\"></a>问题4：选择拍照功能和相册选择图片，原有的页面会onHide</h4><h4 id=\"问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\"><a href=\"#问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\" class=\"headerlink\" title=\"问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom\"></a>问题5：margin-bottom在iOS环境下无效，建议改成padding-bottom</h4><h4 id=\"问题6：wx-createInnerAudioContext-播放语音先try销毁再新建\"><a href=\"#问题6：wx-createInnerAudioContext-播放语音先try销毁再新建\" class=\"headerlink\" title=\"问题6：wx.createInnerAudioContext()播放语音先try销毁再新建\"></a>问题6：wx.createInnerAudioContext()播放语音先try销毁再新建</h4><h4 id=\"问题7：小程序console过多报错-转\"><a href=\"#问题7：小程序console过多报错-转\" class=\"headerlink\" title=\"问题7：小程序console过多报错: 转\"></a>问题7：小程序console过多报错: <a href=\"https://blog.csdn.net/rolan1993/article/details/80431569\" rel=\"external nofollow noopener noreferrer\" target=\"_blank\">转</a></h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">Uncaught TypeError: Converting circular structure to JSON</span><br><span class=\"line\"></span><br><span class=\"line\">解决办法： 注释掉console.log</span><br></pre></td></tr></table></figure><h4 id=\"问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…\"><a href=\"#问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…\" class=\"headerlink\" title=\"问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…\"></a>问题8：setNavigationBarTitle动态异步设置title存在bug，目前官方正在解决中…</h4><h4 id=\"问题9：wxs文件解决wxml中不能写计算逻辑问题\"><a href=\"#问题9：wxs文件解决wxml中不能写计算逻辑问题\" class=\"headerlink\" title=\"问题9：wxs文件解决wxml中不能写计算逻辑问题\"></a>问题9：wxs文件解决wxml中不能写计算逻辑问题</h4><h4 id=\"问题10：setData修改数组某一项值时可以不用全局赋值\"><a href=\"#问题10：setData修改数组某一项值时可以不用全局赋值\" class=\"headerlink\" title=\"问题10：setData修改数组某一项值时可以不用全局赋值\"></a>问题10：setData修改数组某一项值时可以不用全局赋值</h4><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><span class=\"line\">var price = &apos;goods[&apos;+index+&apos;].price&apos;</span><br><span class=\"line\">this.setData(&#123;</span><br><span class=\"line\">    [price]:&apos;changed data&apos;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure><h4 id=\"问题11：阿拉伯数字-会增大一行的font-size\"><a href=\"#问题11：阿拉伯数字-会增大一行的font-size\" class=\"headerlink\" title=\"问题11：阿拉伯数字 会增大一行的font-size\"></a>问题11：阿拉伯数字 会增大一行的font-size</h4><!-- rebuild by neat -->"},{"title":"CSS实现文字滚动，类型京东商城公告栏","_content":"实现文字滚动，第一时间想用swiper进行，但是需求功能较少，不需要引用外部swiper.js，直接用CSS的animate属性实现文字滚动，2秒滚动一次，实现如下:\n\n```html\n<div class=\"notice\">\n <ul>\n <li>第1条公告第1条公告第1条公告第1条公告第1条公告第1条公告</li>\n <li>第2条公告第2条公告第2条公告第2条公告第2条公告第2条公告</li>\n <li>第3条公告第3条公告第3条公告第3条公告第3条公告第3条公告</li>\n <li>第4条公告第4条公告第4条公告第4条公告第4条公告第4条公告</li>\n </ul>\n</div>\n\n```\n\n```css\ndiv,ul,li{margin: 0;padding: 0}/*先初始化一下默认样式*/\n.notice {\n width: 300px;/*单行显示，超出隐藏*/\n height: 35px;/*固定公告栏显示区域的高度*/\n padding: 0 30px;\n background-color: #b3effe;\n overflow: hidden;\n}\n.notice ul li {\n list-style: none;\n line-height: 35px;\n /*以下为了单行显示，超出隐藏*/\n display: block;\n white-space: nowrap;\n text-overflow: ellipsis;\n overflow: hidden;\n}\n```\n\n```js\nfunction noticeUp(obj,top,time) {\n $(obj).animate({\n marginTop: top\n }, time, function () {\n $(this).css({marginTop:\"0\"}).find(\":first\").appendTo(this);\n })\n}\n\n setInterval(\"noticeUp('.notice ul','-35px',500)\", 2000);\n```","source":"_posts/CSS实现文字滚动，类似公告展示.md","raw":"---\ntitle: 'CSS实现文字滚动，类型京东商城公告栏'\n---\n实现文字滚动，第一时间想用swiper进行，但是需求功能较少，不需要引用外部swiper.js，直接用CSS的animate属性实现文字滚动，2秒滚动一次，实现如下:\n\n```html\n<div class=\"notice\">\n <ul>\n <li>第1条公告第1条公告第1条公告第1条公告第1条公告第1条公告</li>\n <li>第2条公告第2条公告第2条公告第2条公告第2条公告第2条公告</li>\n <li>第3条公告第3条公告第3条公告第3条公告第3条公告第3条公告</li>\n <li>第4条公告第4条公告第4条公告第4条公告第4条公告第4条公告</li>\n </ul>\n</div>\n\n```\n\n```css\ndiv,ul,li{margin: 0;padding: 0}/*先初始化一下默认样式*/\n.notice {\n width: 300px;/*单行显示，超出隐藏*/\n height: 35px;/*固定公告栏显示区域的高度*/\n padding: 0 30px;\n background-color: #b3effe;\n overflow: hidden;\n}\n.notice ul li {\n list-style: none;\n line-height: 35px;\n /*以下为了单行显示，超出隐藏*/\n display: block;\n white-space: nowrap;\n text-overflow: ellipsis;\n overflow: hidden;\n}\n```\n\n```js\nfunction noticeUp(obj,top,time) {\n $(obj).animate({\n marginTop: top\n }, time, function () {\n $(this).css({marginTop:\"0\"}).find(\":first\").appendTo(this);\n })\n}\n\n setInterval(\"noticeUp('.notice ul','-35px',500)\", 2000);\n```","slug":"CSS实现文字滚动，类似公告展示","published":1,"date":"2018-05-17T11:44:26.000Z","updated":"2018-05-17T11:44:26.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjkmaz6560001fkq3trsowulz","content":"<p>实现文字滚动，第一时间想用swiper进行，但是需求功能较少，不需要引用外部swiper.js，直接用CSS的animate属性实现文字滚动，2秒滚动一次，实现如下:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"notice\"</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第1条公告第1条公告第1条公告第1条公告第1条公告第1条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第2条公告第2条公告第2条公告第2条公告第2条公告第2条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第3条公告第3条公告第3条公告第3条公告第3条公告第3条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第4条公告第4条公告第4条公告第4条公告第4条公告第4条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span>,<span class=\"selector-tag\">ul</span>,<span class=\"selector-tag\">li</span>&#123;<span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;<span class=\"attribute\">padding</span>: <span class=\"number\">0</span>&#125;<span class=\"comment\">/*先初始化一下默认样式*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.notice</span> &#123;</span><br><span class=\"line\"> <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;<span class=\"comment\">/*单行显示，超出隐藏*/</span></span><br><span class=\"line\"> <span class=\"attribute\">height</span>: <span class=\"number\">35px</span>;<span class=\"comment\">/*固定公告栏显示区域的高度*/</span></span><br><span class=\"line\"> <span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">30px</span>;</span><br><span class=\"line\"> <span class=\"attribute\">background-color</span>: <span class=\"number\">#b3effe</span>;</span><br><span class=\"line\"> <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.notice</span> <span class=\"selector-tag\">ul</span> <span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\"> <span class=\"attribute\">list-style</span>: none;</span><br><span class=\"line\"> <span class=\"attribute\">line-height</span>: <span class=\"number\">35px</span>;</span><br><span class=\"line\"> <span class=\"comment\">/*以下为了单行显示，超出隐藏*/</span></span><br><span class=\"line\"> <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\"> <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\"> <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\"> <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">noticeUp</span>(<span class=\"params\">obj,top,time</span>) </span>&#123;</span><br><span class=\"line\"> $(obj).animate(&#123;</span><br><span class=\"line\"> marginTop: top</span><br><span class=\"line\"> &#125;, time, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"> $(<span class=\"keyword\">this</span>).css(&#123;<span class=\"attr\">marginTop</span>:<span class=\"string\">\"0\"</span>&#125;).find(<span class=\"string\">\":first\"</span>).appendTo(<span class=\"keyword\">this</span>);</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> setInterval(<span class=\"string\">\"noticeUp('.notice ul','-35px',500)\"</span>, <span class=\"number\">2000</span>);</span><br></pre></td></tr></table></figure>","site":{"data":{}},"excerpt":"","more":"<p>实现文字滚动，第一时间想用swiper进行，但是需求功能较少，不需要引用外部swiper.js，直接用CSS的animate属性实现文字滚动，2秒滚动一次，实现如下:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"notice\"</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第1条公告第1条公告第1条公告第1条公告第1条公告第1条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第2条公告第2条公告第2条公告第2条公告第2条公告第2条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第3条公告第3条公告第3条公告第3条公告第3条公告第3条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;<span class=\"name\">li</span>&gt;</span>第4条公告第4条公告第4条公告第4条公告第4条公告第4条公告<span class=\"tag\">&lt;/<span class=\"name\">li</span>&gt;</span></span><br><span class=\"line\"> <span class=\"tag\">&lt;/<span class=\"name\">ul</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-tag\">div</span>,<span class=\"selector-tag\">ul</span>,<span class=\"selector-tag\">li</span>&#123;<span class=\"attribute\">margin</span>: <span class=\"number\">0</span>;<span class=\"attribute\">padding</span>: <span class=\"number\">0</span>&#125;<span class=\"comment\">/*先初始化一下默认样式*/</span></span><br><span class=\"line\"><span class=\"selector-class\">.notice</span> &#123;</span><br><span class=\"line\"> <span class=\"attribute\">width</span>: <span class=\"number\">300px</span>;<span class=\"comment\">/*单行显示，超出隐藏*/</span></span><br><span class=\"line\"> <span class=\"attribute\">height</span>: <span class=\"number\">35px</span>;<span class=\"comment\">/*固定公告栏显示区域的高度*/</span></span><br><span class=\"line\"> <span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">30px</span>;</span><br><span class=\"line\"> <span class=\"attribute\">background-color</span>: <span class=\"number\">#b3effe</span>;</span><br><span class=\"line\"> <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.notice</span> <span class=\"selector-tag\">ul</span> <span class=\"selector-tag\">li</span> &#123;</span><br><span class=\"line\"> <span class=\"attribute\">list-style</span>: none;</span><br><span class=\"line\"> <span class=\"attribute\">line-height</span>: <span class=\"number\">35px</span>;</span><br><span class=\"line\"> <span class=\"comment\">/*以下为了单行显示，超出隐藏*/</span></span><br><span class=\"line\"> <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\"> <span class=\"attribute\">white-space</span>: nowrap;</span><br><span class=\"line\"> <span class=\"attribute\">text-overflow</span>: ellipsis;</span><br><span class=\"line\"> <span class=\"attribute\">overflow</span>: hidden;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">noticeUp</span>(<span class=\"params\">obj,top,time</span>) </span>&#123;</span><br><span class=\"line\"> $(obj).animate(&#123;</span><br><span class=\"line\"> marginTop: top</span><br><span class=\"line\"> &#125;, time, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\"> $(<span class=\"keyword\">this</span>).css(&#123;<span class=\"attr\">marginTop</span>:<span class=\"string\">\"0\"</span>&#125;).find(<span class=\"string\">\":first\"</span>).appendTo(<span class=\"keyword\">this</span>);</span><br><span class=\"line\"> &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"> setInterval(<span class=\"string\">\"noticeUp('.notice ul','-35px',500)\"</span>, <span class=\"number\">2000</span>);</span><br></pre></td></tr></table></figure>"},{"title":"微信公众号本地调试小技巧","_content":"本地调试是公众号开发过程中不可缺少的步骤，我们不可能每次开发都上传到服务器再用微信去查看本地效果，这样一方面效率低，另一方面存在一定的风险性。那么有没有什么办法能够让开发者本地调试代码呢，答案是有的，网上搜出了很多方法，比如ngrok、花生壳、natapp.cn等工具，下面介绍的是[ngrok](https://ngrok.com/)，其他的嫌麻烦。\n\n## ngrok使用\n\n### 1. 为什么要用ngrok\n&nbsp;&nbsp;&nbsp;&nbsp;在微信开发的时候需要填写与微信服务器相连接的url才能授权，这个url必须是外网域名，也就是说我们需要在这个外网域名对应的ip服务器上做开发，而没办法本地开发调试所以用ngrok获得一个外网域名 这个外网域名实际访问的是本地主机这样把此外网域名填入到微信需要的外网url里就可以在本地开发调试了。\n\n### 2.使用ngrok\n&nbsp;&nbsp;&nbsp;&nbsp;首先到官网下载[ngrok](https://ngrok.com/)，然后注册一个ngrok帐号拿到token，这个token自定义域名的时候使用，[具体看这里](https://dashboard.ngrok.com/get-started)。我本人使用的MAC，需到ngrok目录下执行命令\n![](/images/ngrok1.png)\n这时候ngrok已经生成了一个外网域名`http://4f75fc79.ngrok.io`访问本机`localhost:80`\n![](/images/ngrok2.png)\n浏览器里直接访问`http://4f75fc79.ngrok.io`就可以访问本地。\n现在外网有了，就可以开始授权了。为了避免和线上冲突，我注册了一个微信公众号开发者测试号，已经能够调用微信开放的大多数JS接口了。创建公众号测试帐号方法可以自行百度.\n![](/images/ngrok3.jpg)\n此处有一个坑，网上很多都说这里的token是随便写的，的确，但是作为一个前端开发者，在没有后端资源情况下随便填写的token总是报token无效错误，这是因为保存修改时微信会向填写的URL发送一个验证请求，验证token是否有效，但是我们不知道token是多少，现在如何做呢？我有node.js爸爸，还怕什么呢，我们可以本地起一个服务来监听微信请求的URL，上面说到微信此时会发起一个get请求到\n`http://4f75fc79.ngrok.io`那我就本地写一个服务来监听，只要服务里的token和修改的一致不就可以匹配了吗？说干就干，直接上代码\n```js\nvar PORT=80;                 //监听80端口号\nvar http=require('http');  \nvar qs=require('qs');\nvar TOKEN='token';           //必须与测试号所填写的Token相同\n\nfunction checkSignature(params,token){\n    var key=[token,params.timestamp,params.nonce].sort().join(''); \n     //将token （自己设置的） 、timestamp（时间戳）、nonce（随机数）三个参数进行字典排序\n    var sha1=require('crypto').createHash('sha1');\n     //将上面三个字符串拼接成一个字符串再进行sha1加密\n    sha1.update(key);\n    return sha1.digest('hex') ==params.signature;\n     //将加密后的字符串与signature进行对比，若成功，返回echostr\n}\n\nvar server=http.createServer(function (request,response) {\n   var query=require('url').parse(request.url).query;\n    var params=qs.parse(query);\n\n    console.log(params);\n    console.log(\"token :\",TOKEN);\n\n\n    if(!checkSignature(params,TOKEN)){\n        //如果签名不对，结束请求并返回\n        response.end('signature fail');\n    }\n\n    if (request.method == \"GET\") {\n        //如果请求是GET，返回echostr用于通过服务器有效校验\n        response.end(params.echostr);\n    }else{\n        //否则是微信给开发者服务器的POST请求\n        var postdata='';\n        request.addListener(\"data\",function(postchunk){\n            postdata+=postchunk;\n        });\n        //获取到了POST数据\n        request.addListener(\"end\",function(){\n            console.log(postdata);\n            response.end('success ');\n        });\n    }\n});\n\nserver.listen(PORT, function () {\n    console.log('Server running at port:'+PORT);\n});\n```\n微信发起的请求直接到我们本地，那还不是我想怎么玩就怎么玩，嘿嘿嘿！具体操作看[这里](https://blog.csdn.net/yezhenxu1992/article/details/51691649)\n修改接口配置成功后就可以调用测试号里面的所有js接口了，实现本地调试微信公众号不再是奢望！！！\n","source":"_posts/ngrok.md","raw":"---\ntitle: 微信公众号本地调试小技巧\n---\n本地调试是公众号开发过程中不可缺少的步骤，我们不可能每次开发都上传到服务器再用微信去查看本地效果，这样一方面效率低，另一方面存在一定的风险性。那么有没有什么办法能够让开发者本地调试代码呢，答案是有的，网上搜出了很多方法，比如ngrok、花生壳、natapp.cn等工具，下面介绍的是[ngrok](https://ngrok.com/)，其他的嫌麻烦。\n\n## ngrok使用\n\n### 1. 为什么要用ngrok\n&nbsp;&nbsp;&nbsp;&nbsp;在微信开发的时候需要填写与微信服务器相连接的url才能授权，这个url必须是外网域名，也就是说我们需要在这个外网域名对应的ip服务器上做开发，而没办法本地开发调试所以用ngrok获得一个外网域名 这个外网域名实际访问的是本地主机这样把此外网域名填入到微信需要的外网url里就可以在本地开发调试了。\n\n### 2.使用ngrok\n&nbsp;&nbsp;&nbsp;&nbsp;首先到官网下载[ngrok](https://ngrok.com/)，然后注册一个ngrok帐号拿到token，这个token自定义域名的时候使用，[具体看这里](https://dashboard.ngrok.com/get-started)。我本人使用的MAC，需到ngrok目录下执行命令\n![](/images/ngrok1.png)\n这时候ngrok已经生成了一个外网域名`http://4f75fc79.ngrok.io`访问本机`localhost:80`\n![](/images/ngrok2.png)\n浏览器里直接访问`http://4f75fc79.ngrok.io`就可以访问本地。\n现在外网有了，就可以开始授权了。为了避免和线上冲突，我注册了一个微信公众号开发者测试号，已经能够调用微信开放的大多数JS接口了。创建公众号测试帐号方法可以自行百度.\n![](/images/ngrok3.jpg)\n此处有一个坑，网上很多都说这里的token是随便写的，的确，但是作为一个前端开发者，在没有后端资源情况下随便填写的token总是报token无效错误，这是因为保存修改时微信会向填写的URL发送一个验证请求，验证token是否有效，但是我们不知道token是多少，现在如何做呢？我有node.js爸爸，还怕什么呢，我们可以本地起一个服务来监听微信请求的URL，上面说到微信此时会发起一个get请求到\n`http://4f75fc79.ngrok.io`那我就本地写一个服务来监听，只要服务里的token和修改的一致不就可以匹配了吗？说干就干，直接上代码\n```js\nvar PORT=80;                 //监听80端口号\nvar http=require('http');  \nvar qs=require('qs');\nvar TOKEN='token';           //必须与测试号所填写的Token相同\n\nfunction checkSignature(params,token){\n    var key=[token,params.timestamp,params.nonce].sort().join(''); \n     //将token （自己设置的） 、timestamp（时间戳）、nonce（随机数）三个参数进行字典排序\n    var sha1=require('crypto').createHash('sha1');\n     //将上面三个字符串拼接成一个字符串再进行sha1加密\n    sha1.update(key);\n    return sha1.digest('hex') ==params.signature;\n     //将加密后的字符串与signature进行对比，若成功，返回echostr\n}\n\nvar server=http.createServer(function (request,response) {\n   var query=require('url').parse(request.url).query;\n    var params=qs.parse(query);\n\n    console.log(params);\n    console.log(\"token :\",TOKEN);\n\n\n    if(!checkSignature(params,TOKEN)){\n        //如果签名不对，结束请求并返回\n        response.end('signature fail');\n    }\n\n    if (request.method == \"GET\") {\n        //如果请求是GET，返回echostr用于通过服务器有效校验\n        response.end(params.echostr);\n    }else{\n        //否则是微信给开发者服务器的POST请求\n        var postdata='';\n        request.addListener(\"data\",function(postchunk){\n            postdata+=postchunk;\n        });\n        //获取到了POST数据\n        request.addListener(\"end\",function(){\n            console.log(postdata);\n            response.end('success ');\n        });\n    }\n});\n\nserver.listen(PORT, function () {\n    console.log('Server running at port:'+PORT);\n});\n```\n微信发起的请求直接到我们本地，那还不是我想怎么玩就怎么玩，嘿嘿嘿！具体操作看[这里](https://blog.csdn.net/yezhenxu1992/article/details/51691649)\n修改接口配置成功后就可以调用测试号里面的所有js接口了，实现本地调试微信公众号不再是奢望！！！\n","slug":"ngrok","published":1,"date":"2018-04-09T09:09:17.000Z","updated":"2018-04-09T09:09:17.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjkmaz65b0002fkq3qil30e7t","content":"<p>本地调试是公众号开发过程中不可缺少的步骤，我们不可能每次开发都上传到服务器再用微信去查看本地效果，这样一方面效率低，另一方面存在一定的风险性。那么有没有什么办法能够让开发者本地调试代码呢，答案是有的，网上搜出了很多方法，比如ngrok、花生壳、natapp.cn等工具，下面介绍的是<a href=\"https://ngrok.com/\" target=\"_blank\" rel=\"noopener\">ngrok</a>，其他的嫌麻烦。</p>\n<h2 id=\"ngrok使用\"><a href=\"#ngrok使用\" class=\"headerlink\" title=\"ngrok使用\"></a>ngrok使用</h2><h3 id=\"1-为什么要用ngrok\"><a href=\"#1-为什么要用ngrok\" class=\"headerlink\" title=\"1. 为什么要用ngrok\"></a>1. 为什么要用ngrok</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;在微信开发的时候需要填写与微信服务器相连接的url才能授权，这个url必须是外网域名，也就是说我们需要在这个外网域名对应的ip服务器上做开发，而没办法本地开发调试所以用ngrok获得一个外网域名 这个外网域名实际访问的是本地主机这样把此外网域名填入到微信需要的外网url里就可以在本地开发调试了。</p>\n<h3 id=\"2-使用ngrok\"><a href=\"#2-使用ngrok\" class=\"headerlink\" title=\"2.使用ngrok\"></a>2.使用ngrok</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;首先到官网下载<a href=\"https://ngrok.com/\" target=\"_blank\" rel=\"noopener\">ngrok</a>，然后注册一个ngrok帐号拿到token，这个token自定义域名的时候使用，<a href=\"https://dashboard.ngrok.com/get-started\" target=\"_blank\" rel=\"noopener\">具体看这里</a>。我本人使用的MAC，需到ngrok目录下执行命令<br><img src=\"/images/ngrok1.png\" alt=\"\"><br>这时候ngrok已经生成了一个外网域名<code>http://4f75fc79.ngrok.io</code>访问本机<code>localhost:80</code><br><img src=\"/images/ngrok2.png\" alt=\"\"><br>浏览器里直接访问<code>http://4f75fc79.ngrok.io</code>就可以访问本地。<br>现在外网有了，就可以开始授权了。为了避免和线上冲突，我注册了一个微信公众号开发者测试号，已经能够调用微信开放的大多数JS接口了。创建公众号测试帐号方法可以自行百度.<br><img src=\"/images/ngrok3.jpg\" alt=\"\"><br>此处有一个坑，网上很多都说这里的token是随便写的，的确，但是作为一个前端开发者，在没有后端资源情况下随便填写的token总是报token无效错误，这是因为保存修改时微信会向填写的URL发送一个验证请求，验证token是否有效，但是我们不知道token是多少，现在如何做呢？我有node.js爸爸，还怕什么呢，我们可以本地起一个服务来监听微信请求的URL，上面说到微信此时会发起一个get请求到<br><code>http://4f75fc79.ngrok.io</code>那我就本地写一个服务来监听，只要服务里的token和修改的一致不就可以匹配了吗？说干就干，直接上代码<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> PORT=<span class=\"number\">80</span>;                 <span class=\"comment\">//监听80端口号</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http=<span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">var</span> qs=<span class=\"built_in\">require</span>(<span class=\"string\">'qs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> TOKEN=<span class=\"string\">'token'</span>;           <span class=\"comment\">//必须与测试号所填写的Token相同</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkSignature</span>(<span class=\"params\">params,token</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> key=[token,params.timestamp,params.nonce].sort().join(<span class=\"string\">''</span>); </span><br><span class=\"line\">     <span class=\"comment\">//将token （自己设置的） 、timestamp（时间戳）、nonce（随机数）三个参数进行字典排序</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> sha1=<span class=\"built_in\">require</span>(<span class=\"string\">'crypto'</span>).createHash(<span class=\"string\">'sha1'</span>);</span><br><span class=\"line\">     <span class=\"comment\">//将上面三个字符串拼接成一个字符串再进行sha1加密</span></span><br><span class=\"line\">    sha1.update(key);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sha1.digest(<span class=\"string\">'hex'</span>) ==params.signature;</span><br><span class=\"line\">     <span class=\"comment\">//将加密后的字符串与signature进行对比，若成功，返回echostr</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> server=http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">request,response</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> query=<span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>).parse(request.url).query;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> params=qs.parse(query);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(params);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"token :\"</span>,TOKEN);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!checkSignature(params,TOKEN))&#123;</span><br><span class=\"line\">        <span class=\"comment\">//如果签名不对，结束请求并返回</span></span><br><span class=\"line\">        response.end(<span class=\"string\">'signature fail'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (request.method == <span class=\"string\">\"GET\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//如果请求是GET，返回echostr用于通过服务器有效校验</span></span><br><span class=\"line\">        response.end(params.echostr);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//否则是微信给开发者服务器的POST请求</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> postdata=<span class=\"string\">''</span>;</span><br><span class=\"line\">        request.addListener(<span class=\"string\">\"data\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">postchunk</span>)</span>&#123;</span><br><span class=\"line\">            postdata+=postchunk;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//获取到了POST数据</span></span><br><span class=\"line\">        request.addListener(<span class=\"string\">\"end\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(postdata);</span><br><span class=\"line\">            response.end(<span class=\"string\">'success '</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(PORT, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Server running at port:'</span>+PORT);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>微信发起的请求直接到我们本地，那还不是我想怎么玩就怎么玩，嘿嘿嘿！具体操作看<a href=\"https://blog.csdn.net/yezhenxu1992/article/details/51691649\" target=\"_blank\" rel=\"noopener\">这里</a><br>修改接口配置成功后就可以调用测试号里面的所有js接口了，实现本地调试微信公众号不再是奢望！！！</p>\n","site":{"data":{}},"excerpt":"","more":"<p>本地调试是公众号开发过程中不可缺少的步骤，我们不可能每次开发都上传到服务器再用微信去查看本地效果，这样一方面效率低，另一方面存在一定的风险性。那么有没有什么办法能够让开发者本地调试代码呢，答案是有的，网上搜出了很多方法，比如ngrok、花生壳、natapp.cn等工具，下面介绍的是<a href=\"https://ngrok.com/\" target=\"_blank\" rel=\"noopener\">ngrok</a>，其他的嫌麻烦。</p>\n<h2 id=\"ngrok使用\"><a href=\"#ngrok使用\" class=\"headerlink\" title=\"ngrok使用\"></a>ngrok使用</h2><h3 id=\"1-为什么要用ngrok\"><a href=\"#1-为什么要用ngrok\" class=\"headerlink\" title=\"1. 为什么要用ngrok\"></a>1. 为什么要用ngrok</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;在微信开发的时候需要填写与微信服务器相连接的url才能授权，这个url必须是外网域名，也就是说我们需要在这个外网域名对应的ip服务器上做开发，而没办法本地开发调试所以用ngrok获得一个外网域名 这个外网域名实际访问的是本地主机这样把此外网域名填入到微信需要的外网url里就可以在本地开发调试了。</p>\n<h3 id=\"2-使用ngrok\"><a href=\"#2-使用ngrok\" class=\"headerlink\" title=\"2.使用ngrok\"></a>2.使用ngrok</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;首先到官网下载<a href=\"https://ngrok.com/\" target=\"_blank\" rel=\"noopener\">ngrok</a>，然后注册一个ngrok帐号拿到token，这个token自定义域名的时候使用，<a href=\"https://dashboard.ngrok.com/get-started\" target=\"_blank\" rel=\"noopener\">具体看这里</a>。我本人使用的MAC，需到ngrok目录下执行命令<br><img src=\"/images/ngrok1.png\" alt=\"\"><br>这时候ngrok已经生成了一个外网域名<code>http://4f75fc79.ngrok.io</code>访问本机<code>localhost:80</code><br><img src=\"/images/ngrok2.png\" alt=\"\"><br>浏览器里直接访问<code>http://4f75fc79.ngrok.io</code>就可以访问本地。<br>现在外网有了，就可以开始授权了。为了避免和线上冲突，我注册了一个微信公众号开发者测试号，已经能够调用微信开放的大多数JS接口了。创建公众号测试帐号方法可以自行百度.<br><img src=\"/images/ngrok3.jpg\" alt=\"\"><br>此处有一个坑，网上很多都说这里的token是随便写的，的确，但是作为一个前端开发者，在没有后端资源情况下随便填写的token总是报token无效错误，这是因为保存修改时微信会向填写的URL发送一个验证请求，验证token是否有效，但是我们不知道token是多少，现在如何做呢？我有node.js爸爸，还怕什么呢，我们可以本地起一个服务来监听微信请求的URL，上面说到微信此时会发起一个get请求到<br><code>http://4f75fc79.ngrok.io</code>那我就本地写一个服务来监听，只要服务里的token和修改的一致不就可以匹配了吗？说干就干，直接上代码<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> PORT=<span class=\"number\">80</span>;                 <span class=\"comment\">//监听80端口号</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> http=<span class=\"built_in\">require</span>(<span class=\"string\">'http'</span>);  </span><br><span class=\"line\"><span class=\"keyword\">var</span> qs=<span class=\"built_in\">require</span>(<span class=\"string\">'qs'</span>);</span><br><span class=\"line\"><span class=\"keyword\">var</span> TOKEN=<span class=\"string\">'token'</span>;           <span class=\"comment\">//必须与测试号所填写的Token相同</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkSignature</span>(<span class=\"params\">params,token</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> key=[token,params.timestamp,params.nonce].sort().join(<span class=\"string\">''</span>); </span><br><span class=\"line\">     <span class=\"comment\">//将token （自己设置的） 、timestamp（时间戳）、nonce（随机数）三个参数进行字典排序</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> sha1=<span class=\"built_in\">require</span>(<span class=\"string\">'crypto'</span>).createHash(<span class=\"string\">'sha1'</span>);</span><br><span class=\"line\">     <span class=\"comment\">//将上面三个字符串拼接成一个字符串再进行sha1加密</span></span><br><span class=\"line\">    sha1.update(key);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> sha1.digest(<span class=\"string\">'hex'</span>) ==params.signature;</span><br><span class=\"line\">     <span class=\"comment\">//将加密后的字符串与signature进行对比，若成功，返回echostr</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">var</span> server=http.createServer(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">request,response</span>) </span>&#123;</span><br><span class=\"line\">   <span class=\"keyword\">var</span> query=<span class=\"built_in\">require</span>(<span class=\"string\">'url'</span>).parse(request.url).query;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> params=qs.parse(query);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(params);</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">\"token :\"</span>,TOKEN);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(!checkSignature(params,TOKEN))&#123;</span><br><span class=\"line\">        <span class=\"comment\">//如果签名不对，结束请求并返回</span></span><br><span class=\"line\">        response.end(<span class=\"string\">'signature fail'</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (request.method == <span class=\"string\">\"GET\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//如果请求是GET，返回echostr用于通过服务器有效校验</span></span><br><span class=\"line\">        response.end(params.echostr);</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//否则是微信给开发者服务器的POST请求</span></span><br><span class=\"line\">        <span class=\"keyword\">var</span> postdata=<span class=\"string\">''</span>;</span><br><span class=\"line\">        request.addListener(<span class=\"string\">\"data\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">postchunk</span>)</span>&#123;</span><br><span class=\"line\">            postdata+=postchunk;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        <span class=\"comment\">//获取到了POST数据</span></span><br><span class=\"line\">        request.addListener(<span class=\"string\">\"end\"</span>,<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"built_in\">console</span>.log(postdata);</span><br><span class=\"line\">            response.end(<span class=\"string\">'success '</span>);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">server.listen(PORT, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'Server running at port:'</span>+PORT);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n<p>微信发起的请求直接到我们本地，那还不是我想怎么玩就怎么玩，嘿嘿嘿！具体操作看<a href=\"https://blog.csdn.net/yezhenxu1992/article/details/51691649\" target=\"_blank\" rel=\"noopener\">这里</a><br>修改接口配置成功后就可以调用测试号里面的所有js接口了，实现本地调试微信公众号不再是奢望！！！</p>\n"},{"title":"微信JSSDK遇到的那些坑","_content":"作为一个前端开发者，相信很多同道中人在微信公众号的开发中被坑的很惨，我也分享开发过程中的一点点经验给大家，可以减少很多弯路。由于项目需要，前端开发使用的是angular4.0技术，微信开发工具v1.02。前端开发公众号最坑的就是微信JSSDK的使用，前面坑路漫漫，我还得一步一步趟过去。\n\n## JSSDK使用报错\n\n### 1. config:invalid signature一直报这个错误\n&nbsp;&nbsp;&nbsp;&nbsp;`建议：首先查看微信官方网站给出的解决方案.`[链接](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html) [获取access_token](https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=wxf17b04f12b73b60c&secret=345d810799934a7736f60f95ddbbf84b)\n&nbsp;&nbsp;&nbsp;&nbsp;建议按如下顺序查找错误：\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.确认签名算法正确，可用 http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign 页面工具进行校验。也就是你自己后台生成签名要和微信校验算法生成的签名一致才可以（可能大小写不同）。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.确认config中nonceStr（js中驼峰标准大写S）, timestamp与用以签名中的对应noncestr, timestamp一致。\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.确认url是页面完整的url(请在当前页面alert(location.href.split('#')[0])确认)，包括'http(s)://'部分，以及'？'后面的GET参数部分,但不包括'#'hash后面的部分。\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.确认 config 中的 appid 与用来获取 jsapi_ticket 的 appid 一致。\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.确保一定缓存access_token和jsapi_ticket。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.出现问题的原因是参与签名的URL地址不正确，需要动态获取当前页面完整的URL地址（包括?后面的参数，但不能包含#号），如若URL地址为：`http://www.xxx.xxx/payment/wxpay/jspay?oid=xxxx&attr=xxxx#wechat`，那么完整的URL地址应该是截取#号之前的部份。为什么会出现#号呢？因为你的URL在被分享到朋友圈等微信系统自动会添加一些参数。\n&nbsp;&nbsp;&nbsp;&nbsp;PS：这里有一个大坑，就是Android和iOS对于当前页面的URL有不同的理解，iOS微信JSSDK授权易出错，但是筛选页面后又OK了，Android每次授权是OK的，具体介绍[看这里](https://gitissue.com/issues/5ab609afefbdd46ca4725b98)。原因就是因为iOS和Android对URL的识别机制不同：Android每次进行新页面时当前URL也是最新的，而iOS每次进去新页面时实际URL是第一次进入应用的URL，刷新之后当前页面URL就是最新URL。\n``` bash\n     解决办法： 在home页判断当前平台是否为iOS，若为iOS，此时通过wx.config()授权，获取直接通过window.location.href链接跳转来改变当前页面URL\n```\n\n### 2. permission denied权限错误\n&nbsp;&nbsp;&nbsp;&nbsp;首先查看微信给出的错误说明：该公众号没有权限使用这个JSAPI（部分接口需要认证之后才能使)。\n&nbsp;&nbsp;&nbsp;&nbsp;说明：只要通过了公众号认证，都不会有问题。\n&nbsp;&nbsp;&nbsp;&nbsp;检查对象：如果出现这个说明程序上基本上不会有问题 微信后台已经返回了数据。\n&nbsp;&nbsp;&nbsp;&nbsp;第一、要检查 你的config 文件中相应的 jsApiList数组中是否包含了该接口。\n```js\nwx.config({\n    debug: false,\n    appId: '',\n\ttimestamp:'',\n\tnonceStr:'',\n\tsignature:'',\n\tjsApiList: [\n\t    'checkJsApi',\n\t    'onMenuShareTimeline',\n\t    'hideOptionMenu'\n\t    ...\n\t]\n});\n```\n","source":"_posts/wx_sdk.md","raw":"---\ntitle: 微信JSSDK遇到的那些坑\n---\n作为一个前端开发者，相信很多同道中人在微信公众号的开发中被坑的很惨，我也分享开发过程中的一点点经验给大家，可以减少很多弯路。由于项目需要，前端开发使用的是angular4.0技术，微信开发工具v1.02。前端开发公众号最坑的就是微信JSSDK的使用，前面坑路漫漫，我还得一步一步趟过去。\n\n## JSSDK使用报错\n\n### 1. config:invalid signature一直报这个错误\n&nbsp;&nbsp;&nbsp;&nbsp;`建议：首先查看微信官方网站给出的解决方案.`[链接](http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html) [获取access_token](https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&appid=wxf17b04f12b73b60c&secret=345d810799934a7736f60f95ddbbf84b)\n&nbsp;&nbsp;&nbsp;&nbsp;建议按如下顺序查找错误：\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.确认签名算法正确，可用 http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign 页面工具进行校验。也就是你自己后台生成签名要和微信校验算法生成的签名一致才可以（可能大小写不同）。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.确认config中nonceStr（js中驼峰标准大写S）, timestamp与用以签名中的对应noncestr, timestamp一致。\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.确认url是页面完整的url(请在当前页面alert(location.href.split('#')[0])确认)，包括'http(s)://'部分，以及'？'后面的GET参数部分,但不包括'#'hash后面的部分。\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.确认 config 中的 appid 与用来获取 jsapi_ticket 的 appid 一致。\n  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.确保一定缓存access_token和jsapi_ticket。\n&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.出现问题的原因是参与签名的URL地址不正确，需要动态获取当前页面完整的URL地址（包括?后面的参数，但不能包含#号），如若URL地址为：`http://www.xxx.xxx/payment/wxpay/jspay?oid=xxxx&attr=xxxx#wechat`，那么完整的URL地址应该是截取#号之前的部份。为什么会出现#号呢？因为你的URL在被分享到朋友圈等微信系统自动会添加一些参数。\n&nbsp;&nbsp;&nbsp;&nbsp;PS：这里有一个大坑，就是Android和iOS对于当前页面的URL有不同的理解，iOS微信JSSDK授权易出错，但是筛选页面后又OK了，Android每次授权是OK的，具体介绍[看这里](https://gitissue.com/issues/5ab609afefbdd46ca4725b98)。原因就是因为iOS和Android对URL的识别机制不同：Android每次进行新页面时当前URL也是最新的，而iOS每次进去新页面时实际URL是第一次进入应用的URL，刷新之后当前页面URL就是最新URL。\n``` bash\n     解决办法： 在home页判断当前平台是否为iOS，若为iOS，此时通过wx.config()授权，获取直接通过window.location.href链接跳转来改变当前页面URL\n```\n\n### 2. permission denied权限错误\n&nbsp;&nbsp;&nbsp;&nbsp;首先查看微信给出的错误说明：该公众号没有权限使用这个JSAPI（部分接口需要认证之后才能使)。\n&nbsp;&nbsp;&nbsp;&nbsp;说明：只要通过了公众号认证，都不会有问题。\n&nbsp;&nbsp;&nbsp;&nbsp;检查对象：如果出现这个说明程序上基本上不会有问题 微信后台已经返回了数据。\n&nbsp;&nbsp;&nbsp;&nbsp;第一、要检查 你的config 文件中相应的 jsApiList数组中是否包含了该接口。\n```js\nwx.config({\n    debug: false,\n    appId: '',\n\ttimestamp:'',\n\tnonceStr:'',\n\tsignature:'',\n\tjsApiList: [\n\t    'checkJsApi',\n\t    'onMenuShareTimeline',\n\t    'hideOptionMenu'\n\t    ...\n\t]\n});\n```\n","slug":"wx_sdk","published":1,"date":"2018-04-19T09:53:52.000Z","updated":"2018-04-19T09:53:52.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjkmaz65e0003fkq3obc7hxuf","content":"<p>作为一个前端开发者，相信很多同道中人在微信公众号的开发中被坑的很惨，我也分享开发过程中的一点点经验给大家，可以减少很多弯路。由于项目需要，前端开发使用的是angular4.0技术，微信开发工具v1.02。前端开发公众号最坑的就是微信JSSDK的使用，前面坑路漫漫，我还得一步一步趟过去。</p>\n<h2 id=\"JSSDK使用报错\"><a href=\"#JSSDK使用报错\" class=\"headerlink\" title=\"JSSDK使用报错\"></a>JSSDK使用报错</h2><h3 id=\"1-config-invalid-signature一直报这个错误\"><a href=\"#1-config-invalid-signature一直报这个错误\" class=\"headerlink\" title=\"1. config:invalid signature一直报这个错误\"></a>1. config:invalid signature一直报这个错误</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;<code>建议：首先查看微信官方网站给出的解决方案.</code><a href=\"http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html\" target=\"_blank\" rel=\"noopener\">链接</a> <a href=\"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=wxf17b04f12b73b60c&amp;secret=345d810799934a7736f60f95ddbbf84b\" target=\"_blank\" rel=\"noopener\">获取access_token</a><br>&nbsp;&nbsp;&nbsp;&nbsp;建议按如下顺序查找错误：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.确认签名算法正确，可用 <a href=\"http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign\" target=\"_blank\" rel=\"noopener\">http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign</a> 页面工具进行校验。也就是你自己后台生成签名要和微信校验算法生成的签名一致才可以（可能大小写不同）。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.确认config中nonceStr（js中驼峰标准大写S）, timestamp与用以签名中的对应noncestr, timestamp一致。<br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.确认url是页面完整的url(请在当前页面alert(location.href.split(‘#’)[0])确认)，包括’http(s)://‘部分，以及’？’后面的GET参数部分,但不包括’#’hash后面的部分。<br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.确认 config 中的 appid 与用来获取 jsapi_ticket 的 appid 一致。<br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.确保一定缓存access_token和jsapi_ticket。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.出现问题的原因是参与签名的URL地址不正确，需要动态获取当前页面完整的URL地址（包括?后面的参数，但不能包含#号），如若URL地址为：<code>http://www.xxx.xxx/payment/wxpay/jspay?oid=xxxx&amp;attr=xxxx#wechat</code>，那么完整的URL地址应该是截取#号之前的部份。为什么会出现#号呢？因为你的URL在被分享到朋友圈等微信系统自动会添加一些参数。<br>&nbsp;&nbsp;&nbsp;&nbsp;PS：这里有一个大坑，就是Android和iOS对于当前页面的URL有不同的理解，iOS微信JSSDK授权易出错，但是筛选页面后又OK了，Android每次授权是OK的，具体介绍<a href=\"https://gitissue.com/issues/5ab609afefbdd46ca4725b98\" target=\"_blank\" rel=\"noopener\">看这里</a>。原因就是因为iOS和Android对URL的识别机制不同：Android每次进行新页面时当前URL也是最新的，而iOS每次进去新页面时实际URL是第一次进入应用的URL，刷新之后当前页面URL就是最新URL。<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">解决办法： 在home页判断当前平台是否为iOS，若为iOS，此时通过wx.config()授权，获取直接通过window.location.href链接跳转来改变当前页面URL</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-permission-denied权限错误\"><a href=\"#2-permission-denied权限错误\" class=\"headerlink\" title=\"2. permission denied权限错误\"></a>2. permission denied权限错误</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;首先查看微信给出的错误说明：该公众号没有权限使用这个JSAPI（部分接口需要认证之后才能使)。<br>&nbsp;&nbsp;&nbsp;&nbsp;说明：只要通过了公众号认证，都不会有问题。<br>&nbsp;&nbsp;&nbsp;&nbsp;检查对象：如果出现这个说明程序上基本上不会有问题 微信后台已经返回了数据。<br>&nbsp;&nbsp;&nbsp;&nbsp;第一、要检查 你的config 文件中相应的 jsApiList数组中是否包含了该接口。<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">wx.config(&#123;</span><br><span class=\"line\">    debug: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    appId: <span class=\"string\">''</span>,</span><br><span class=\"line\">\ttimestamp:<span class=\"string\">''</span>,</span><br><span class=\"line\">\tnonceStr:<span class=\"string\">''</span>,</span><br><span class=\"line\">\tsignature:<span class=\"string\">''</span>,</span><br><span class=\"line\">\tjsApiList: [</span><br><span class=\"line\">\t    <span class=\"string\">'checkJsApi'</span>,</span><br><span class=\"line\">\t    <span class=\"string\">'onMenuShareTimeline'</span>,</span><br><span class=\"line\">\t    <span class=\"string\">'hideOptionMenu'</span></span><br><span class=\"line\">\t    ...</span><br><span class=\"line\">\t]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<p>作为一个前端开发者，相信很多同道中人在微信公众号的开发中被坑的很惨，我也分享开发过程中的一点点经验给大家，可以减少很多弯路。由于项目需要，前端开发使用的是angular4.0技术，微信开发工具v1.02。前端开发公众号最坑的就是微信JSSDK的使用，前面坑路漫漫，我还得一步一步趟过去。</p>\n<h2 id=\"JSSDK使用报错\"><a href=\"#JSSDK使用报错\" class=\"headerlink\" title=\"JSSDK使用报错\"></a>JSSDK使用报错</h2><h3 id=\"1-config-invalid-signature一直报这个错误\"><a href=\"#1-config-invalid-signature一直报这个错误\" class=\"headerlink\" title=\"1. config:invalid signature一直报这个错误\"></a>1. config:invalid signature一直报这个错误</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;<code>建议：首先查看微信官方网站给出的解决方案.</code><a href=\"http://mp.weixin.qq.com/wiki/7/aaa137b55fb2e0456bf8dd9148dd613f.html\" target=\"_blank\" rel=\"noopener\">链接</a> <a href=\"https://api.weixin.qq.com/cgi-bin/token?grant_type=client_credential&amp;appid=wxf17b04f12b73b60c&amp;secret=345d810799934a7736f60f95ddbbf84b\" target=\"_blank\" rel=\"noopener\">获取access_token</a><br>&nbsp;&nbsp;&nbsp;&nbsp;建议按如下顺序查找错误：<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1.确认签名算法正确，可用 <a href=\"http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign\" target=\"_blank\" rel=\"noopener\">http://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=jsapisign</a> 页面工具进行校验。也就是你自己后台生成签名要和微信校验算法生成的签名一致才可以（可能大小写不同）。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2.确认config中nonceStr（js中驼峰标准大写S）, timestamp与用以签名中的对应noncestr, timestamp一致。<br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;3.确认url是页面完整的url(请在当前页面alert(location.href.split(‘#’)[0])确认)，包括’http(s)://‘部分，以及’？’后面的GET参数部分,但不包括’#’hash后面的部分。<br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;4.确认 config 中的 appid 与用来获取 jsapi_ticket 的 appid 一致。<br>  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;5.确保一定缓存access_token和jsapi_ticket。<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;6.出现问题的原因是参与签名的URL地址不正确，需要动态获取当前页面完整的URL地址（包括?后面的参数，但不能包含#号），如若URL地址为：<code>http://www.xxx.xxx/payment/wxpay/jspay?oid=xxxx&amp;attr=xxxx#wechat</code>，那么完整的URL地址应该是截取#号之前的部份。为什么会出现#号呢？因为你的URL在被分享到朋友圈等微信系统自动会添加一些参数。<br>&nbsp;&nbsp;&nbsp;&nbsp;PS：这里有一个大坑，就是Android和iOS对于当前页面的URL有不同的理解，iOS微信JSSDK授权易出错，但是筛选页面后又OK了，Android每次授权是OK的，具体介绍<a href=\"https://gitissue.com/issues/5ab609afefbdd46ca4725b98\" target=\"_blank\" rel=\"noopener\">看这里</a>。原因就是因为iOS和Android对URL的识别机制不同：Android每次进行新页面时当前URL也是最新的，而iOS每次进去新页面时实际URL是第一次进入应用的URL，刷新之后当前页面URL就是最新URL。<br><figure class=\"highlight bash\"><table><tr><td class=\"code\"><pre><span class=\"line\">解决办法： 在home页判断当前平台是否为iOS，若为iOS，此时通过wx.config()授权，获取直接通过window.location.href链接跳转来改变当前页面URL</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-permission-denied权限错误\"><a href=\"#2-permission-denied权限错误\" class=\"headerlink\" title=\"2. permission denied权限错误\"></a>2. permission denied权限错误</h3><p>&nbsp;&nbsp;&nbsp;&nbsp;首先查看微信给出的错误说明：该公众号没有权限使用这个JSAPI（部分接口需要认证之后才能使)。<br>&nbsp;&nbsp;&nbsp;&nbsp;说明：只要通过了公众号认证，都不会有问题。<br>&nbsp;&nbsp;&nbsp;&nbsp;检查对象：如果出现这个说明程序上基本上不会有问题 微信后台已经返回了数据。<br>&nbsp;&nbsp;&nbsp;&nbsp;第一、要检查 你的config 文件中相应的 jsApiList数组中是否包含了该接口。<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">wx.config(&#123;</span><br><span class=\"line\">    debug: <span class=\"literal\">false</span>,</span><br><span class=\"line\">    appId: <span class=\"string\">''</span>,</span><br><span class=\"line\">\ttimestamp:<span class=\"string\">''</span>,</span><br><span class=\"line\">\tnonceStr:<span class=\"string\">''</span>,</span><br><span class=\"line\">\tsignature:<span class=\"string\">''</span>,</span><br><span class=\"line\">\tjsApiList: [</span><br><span class=\"line\">\t    <span class=\"string\">'checkJsApi'</span>,</span><br><span class=\"line\">\t    <span class=\"string\">'onMenuShareTimeline'</span>,</span><br><span class=\"line\">\t    <span class=\"string\">'hideOptionMenu'</span></span><br><span class=\"line\">\t    ...</span><br><span class=\"line\">\t]</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure></p>\n"},{"title":"Canvas实现图片压缩上传","_content":"接到产品需求，问能不能将前端上传的图片压缩？像移动端上传图片，一般都是超清、高清图片，大小也有10M，甚至一张图片大小有15M左右，这样大的图片上传到腾讯云或者阿里云（没使用服务器上传图片）一方面上传速度慢，影响体验，另一方面体积太大占空间，图片压缩避免了，网上搜到了很多这方面介绍的[网址](https://www.cnblogs.com/stoneniqiu/p/5957356.html)，大多数都是用canvas来实现（不说了，马上开干）！。\n## 实现过程 (10M => 200k左右)\n\n### 1. 图片裁剪\n大体的思路是将图片抽样显示在canvas上，然后用通过`canvas.toDataURL`方法得到base64字符串来实现压缩。上代码！！！\n```js\n    const file: {} = e.target.files[0]; // 通过input元素触发的change事件\n    const reader = new FileReader(),\n    img = new Image();\n    // 缩放图片需要的canvas\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    reader.readAsDataURL(file);\n    // base64地址图片加载完毕后\n    img.onload = function () {\n      // 图片原始尺寸\n      const originWidth = this['width'];\n      const originHeight = this['height'];\n      // 最大尺寸限制\n      const maxWidth = 750, maxHeight = 400;\n      // 目标尺寸\n      let targetWidth = originWidth, targetHeight = originHeight;\n      // 图片尺寸超过750x400的限制\n      if (originWidth > maxWidth || originHeight > maxHeight) {\n        if (originWidth / originHeight > maxWidth / maxHeight) {\n          // 更宽，按照宽度限定尺寸\n          targetWidth = maxWidth;\n          targetHeight = Math.round(maxWidth * (originHeight / originWidth));\n        } else {\n          targetHeight = maxHeight;\n          targetWidth = Math.round(maxHeight * (originWidth / originHeight));\n        }\n      }\n\n      // canvas对图片进行缩放\n      canvas.width = targetWidth;\n      canvas.height = targetHeight;\n      // 清除画布\n      context.clearRect(0, 0, targetWidth, targetHeight);\n      // 图片压缩\n      context.drawImage(img, 0, 0, targetWidth, targetHeight);\n      // canvas转为blob并上传\n      // * 很多PC、手机浏览器不支持toBlob方法，如Safari*\n      // 不推荐使用toBlob方法\n      // canvas.toBlob(function($Blob) {\n      // })\n      const dataUrl = canvas.toDataURL('image/jpeg');\n      updateImgForBase64(dataUrl);\n    }\n    reader.onload = function (e) {\n        img.src = e.target['result'];\n    };\n```\n\n### 2. 上传到腾讯云\n项目中图片是保存在腾讯云中，这里就需要用到[腾讯JavaScript SDK](https://cloud.tencent.com/document/product/436/11459)，按照SDK文档去新建存储桶获取Bucket、Region，直接上代码：\n```js\nupdateImgForBase64(img: string, type: string = 'jpeg'): Promise<any> {\n    const vm = this;\n    const storeAs = `avatar/${new Date().getTime()}-${this.guid()}.${type}`;\n    const dataURLtoFile: Function = (dataurl, filename) => {\n      const arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1];\n      const bstr = atob(arr[1]);\n      let n = bstr.length;\n      const u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new File([u8arr], filename, {type: mime});\n    };\n    const file = dataURLtoFile(img, type);\n    \n    // function getBlobBydataURI(dataURI, type) {\n    //   var binary = atob(dataURI.split(',')[1]);\n    //   var array = [];\n    //   for (var i = 0; i < binary.length; i++) {\n    //     array.push(binary.charCodeAt(i));\n    //   }\n    //   return new Blob([new Uint8Array(array)], {type: type});\n    // }\n    //\n    // /**\n    //  * 上传  formData.append(\"files\", $Blob, storeAs);对iOS系统不支持\n    //  */\n    //   //base64 转 blob\n    // let $Blob = getBlobBydataURI(img, 'image/jpeg');\n    // let formData = new FormData();\n    // let storeAs = `documents/${new Date().getTime()}-${this.guid()}.${type}`;\n    // formData.append(\"files\", $Blob, storeAs);\n    //组建XMLHttpRequest 上传文件\n    return new Promise((resolve, reject) => {\n      this.cos.sliceUploadFile({\n        Bucket: 'your bucket',\n        Region: 'your region',\n        Key: storeAs,\n        Body: file\n      }, function (err, data) {\n        if (err) {\n          reject(JSON.stringify(err));\n        } else {\n          resolve(url);\n        }\n      });\n    })\n  }\n```","source":"_posts/图片压缩.md","raw":"---\ntitle: Canvas实现图片压缩上传\n---\n接到产品需求，问能不能将前端上传的图片压缩？像移动端上传图片，一般都是超清、高清图片，大小也有10M，甚至一张图片大小有15M左右，这样大的图片上传到腾讯云或者阿里云（没使用服务器上传图片）一方面上传速度慢，影响体验，另一方面体积太大占空间，图片压缩避免了，网上搜到了很多这方面介绍的[网址](https://www.cnblogs.com/stoneniqiu/p/5957356.html)，大多数都是用canvas来实现（不说了，马上开干）！。\n## 实现过程 (10M => 200k左右)\n\n### 1. 图片裁剪\n大体的思路是将图片抽样显示在canvas上，然后用通过`canvas.toDataURL`方法得到base64字符串来实现压缩。上代码！！！\n```js\n    const file: {} = e.target.files[0]; // 通过input元素触发的change事件\n    const reader = new FileReader(),\n    img = new Image();\n    // 缩放图片需要的canvas\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    reader.readAsDataURL(file);\n    // base64地址图片加载完毕后\n    img.onload = function () {\n      // 图片原始尺寸\n      const originWidth = this['width'];\n      const originHeight = this['height'];\n      // 最大尺寸限制\n      const maxWidth = 750, maxHeight = 400;\n      // 目标尺寸\n      let targetWidth = originWidth, targetHeight = originHeight;\n      // 图片尺寸超过750x400的限制\n      if (originWidth > maxWidth || originHeight > maxHeight) {\n        if (originWidth / originHeight > maxWidth / maxHeight) {\n          // 更宽，按照宽度限定尺寸\n          targetWidth = maxWidth;\n          targetHeight = Math.round(maxWidth * (originHeight / originWidth));\n        } else {\n          targetHeight = maxHeight;\n          targetWidth = Math.round(maxHeight * (originWidth / originHeight));\n        }\n      }\n\n      // canvas对图片进行缩放\n      canvas.width = targetWidth;\n      canvas.height = targetHeight;\n      // 清除画布\n      context.clearRect(0, 0, targetWidth, targetHeight);\n      // 图片压缩\n      context.drawImage(img, 0, 0, targetWidth, targetHeight);\n      // canvas转为blob并上传\n      // * 很多PC、手机浏览器不支持toBlob方法，如Safari*\n      // 不推荐使用toBlob方法\n      // canvas.toBlob(function($Blob) {\n      // })\n      const dataUrl = canvas.toDataURL('image/jpeg');\n      updateImgForBase64(dataUrl);\n    }\n    reader.onload = function (e) {\n        img.src = e.target['result'];\n    };\n```\n\n### 2. 上传到腾讯云\n项目中图片是保存在腾讯云中，这里就需要用到[腾讯JavaScript SDK](https://cloud.tencent.com/document/product/436/11459)，按照SDK文档去新建存储桶获取Bucket、Region，直接上代码：\n```js\nupdateImgForBase64(img: string, type: string = 'jpeg'): Promise<any> {\n    const vm = this;\n    const storeAs = `avatar/${new Date().getTime()}-${this.guid()}.${type}`;\n    const dataURLtoFile: Function = (dataurl, filename) => {\n      const arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1];\n      const bstr = atob(arr[1]);\n      let n = bstr.length;\n      const u8arr = new Uint8Array(n);\n      while (n--) {\n        u8arr[n] = bstr.charCodeAt(n);\n      }\n      return new File([u8arr], filename, {type: mime});\n    };\n    const file = dataURLtoFile(img, type);\n    \n    // function getBlobBydataURI(dataURI, type) {\n    //   var binary = atob(dataURI.split(',')[1]);\n    //   var array = [];\n    //   for (var i = 0; i < binary.length; i++) {\n    //     array.push(binary.charCodeAt(i));\n    //   }\n    //   return new Blob([new Uint8Array(array)], {type: type});\n    // }\n    //\n    // /**\n    //  * 上传  formData.append(\"files\", $Blob, storeAs);对iOS系统不支持\n    //  */\n    //   //base64 转 blob\n    // let $Blob = getBlobBydataURI(img, 'image/jpeg');\n    // let formData = new FormData();\n    // let storeAs = `documents/${new Date().getTime()}-${this.guid()}.${type}`;\n    // formData.append(\"files\", $Blob, storeAs);\n    //组建XMLHttpRequest 上传文件\n    return new Promise((resolve, reject) => {\n      this.cos.sliceUploadFile({\n        Bucket: 'your bucket',\n        Region: 'your region',\n        Key: storeAs,\n        Body: file\n      }, function (err, data) {\n        if (err) {\n          reject(JSON.stringify(err));\n        } else {\n          resolve(url);\n        }\n      });\n    })\n  }\n```","slug":"图片压缩","published":1,"date":"2018-04-09T09:42:58.000Z","updated":"2018-04-09T09:42:58.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjkmaz65g0004fkq3kw3ckwiv","content":"<p>接到产品需求，问能不能将前端上传的图片压缩？像移动端上传图片，一般都是超清、高清图片，大小也有10M，甚至一张图片大小有15M左右，这样大的图片上传到腾讯云或者阿里云（没使用服务器上传图片）一方面上传速度慢，影响体验，另一方面体积太大占空间，图片压缩避免了，网上搜到了很多这方面介绍的<a href=\"https://www.cnblogs.com/stoneniqiu/p/5957356.html\" target=\"_blank\" rel=\"noopener\">网址</a>，大多数都是用canvas来实现（不说了，马上开干）！。</p>\n<h2 id=\"实现过程-10M-gt-200k左右\"><a href=\"#实现过程-10M-gt-200k左右\" class=\"headerlink\" title=\"实现过程 (10M =&gt; 200k左右)\"></a>实现过程 (10M =&gt; 200k左右)</h2><h3 id=\"1-图片裁剪\"><a href=\"#1-图片裁剪\" class=\"headerlink\" title=\"1. 图片裁剪\"></a>1. 图片裁剪</h3><p>大体的思路是将图片抽样显示在canvas上，然后用通过<code>canvas.toDataURL</code>方法得到base64字符串来实现压缩。上代码！！！<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> file: &#123;&#125; = e.target.files[<span class=\"number\">0</span>]; <span class=\"comment\">// 通过input元素触发的change事件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> reader = <span class=\"keyword\">new</span> FileReader(),</span><br><span class=\"line\">img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\"><span class=\"comment\">// 缩放图片需要的canvas</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">reader.readAsDataURL(file);</span><br><span class=\"line\"><span class=\"comment\">// base64地址图片加载完毕后</span></span><br><span class=\"line\">img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 图片原始尺寸</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> originWidth = <span class=\"keyword\">this</span>[<span class=\"string\">'width'</span>];</span><br><span class=\"line\">  <span class=\"keyword\">const</span> originHeight = <span class=\"keyword\">this</span>[<span class=\"string\">'height'</span>];</span><br><span class=\"line\">  <span class=\"comment\">// 最大尺寸限制</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> maxWidth = <span class=\"number\">750</span>, maxHeight = <span class=\"number\">400</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 目标尺寸</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> targetWidth = originWidth, targetHeight = originHeight;</span><br><span class=\"line\">  <span class=\"comment\">// 图片尺寸超过750x400的限制</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (originWidth &gt; maxWidth || originHeight &gt; maxHeight) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (originWidth / originHeight &gt; maxWidth / maxHeight) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 更宽，按照宽度限定尺寸</span></span><br><span class=\"line\">      targetWidth = maxWidth;</span><br><span class=\"line\">      targetHeight = <span class=\"built_in\">Math</span>.round(maxWidth * (originHeight / originWidth));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      targetHeight = maxHeight;</span><br><span class=\"line\">      targetWidth = <span class=\"built_in\">Math</span>.round(maxHeight * (originWidth / originHeight));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// canvas对图片进行缩放</span></span><br><span class=\"line\">  canvas.width = targetWidth;</span><br><span class=\"line\">  canvas.height = targetHeight;</span><br><span class=\"line\">  <span class=\"comment\">// 清除画布</span></span><br><span class=\"line\">  context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, targetWidth, targetHeight);</span><br><span class=\"line\">  <span class=\"comment\">// 图片压缩</span></span><br><span class=\"line\">  context.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, targetWidth, targetHeight);</span><br><span class=\"line\">  <span class=\"comment\">// canvas转为blob并上传</span></span><br><span class=\"line\">  <span class=\"comment\">// * 很多PC、手机浏览器不支持toBlob方法，如Safari*</span></span><br><span class=\"line\">  <span class=\"comment\">// 不推荐使用toBlob方法</span></span><br><span class=\"line\">  <span class=\"comment\">// canvas.toBlob(function($Blob) &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataUrl = canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>);</span><br><span class=\"line\">  updateImgForBase64(dataUrl);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">reader.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    img.src = e.target[<span class=\"string\">'result'</span>];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-上传到腾讯云\"><a href=\"#2-上传到腾讯云\" class=\"headerlink\" title=\"2. 上传到腾讯云\"></a>2. 上传到腾讯云</h3><p>项目中图片是保存在腾讯云中，这里就需要用到<a href=\"https://cloud.tencent.com/document/product/436/11459\" target=\"_blank\" rel=\"noopener\">腾讯JavaScript SDK</a>，按照SDK文档去新建存储桶获取Bucket、Region，直接上代码：<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">updateImgForBase64(img: string, <span class=\"attr\">type</span>: string = <span class=\"string\">'jpeg'</span>): <span class=\"built_in\">Promise</span>&lt;any&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> vm = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> storeAs = <span class=\"string\">`avatar/<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>-<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.guid()&#125;</span>.<span class=\"subst\">$&#123;type&#125;</span>`</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> dataURLtoFile: <span class=\"built_in\">Function</span> = <span class=\"function\">(<span class=\"params\">dataurl, filename</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> arr = dataurl.split(<span class=\"string\">','</span>), mime = arr[<span class=\"number\">0</span>].match(<span class=\"regexp\">/:(.*?);/</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> bstr = atob(arr[<span class=\"number\">1</span>]);</span><br><span class=\"line\">      <span class=\"keyword\">let</span> n = bstr.length;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> u8arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(n);</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (n--) &#123;</span><br><span class=\"line\">        u8arr[n] = bstr.charCodeAt(n);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> File([u8arr], filename, &#123;<span class=\"attr\">type</span>: mime&#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> file = dataURLtoFile(img, type);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// function getBlobBydataURI(dataURI, type) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   var binary = atob(dataURI.split(',')[1]);</span></span><br><span class=\"line\">    <span class=\"comment\">//   var array = [];</span></span><br><span class=\"line\">    <span class=\"comment\">//   for (var i = 0; i &lt; binary.length; i++) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     array.push(binary.charCodeAt(i));</span></span><br><span class=\"line\">    <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">//   return new Blob([new Uint8Array(array)], &#123;type: type&#125;);</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">// /**</span></span><br><span class=\"line\">    <span class=\"comment\">//  * 上传  formData.append(\"files\", $Blob, storeAs);对iOS系统不支持</span></span><br><span class=\"line\">    <span class=\"comment\">//  */</span></span><br><span class=\"line\">    <span class=\"comment\">//   //base64 转 blob</span></span><br><span class=\"line\">    <span class=\"comment\">// let $Blob = getBlobBydataURI(img, 'image/jpeg');</span></span><br><span class=\"line\">    <span class=\"comment\">// let formData = new FormData();</span></span><br><span class=\"line\">    <span class=\"comment\">// let storeAs = `documents/$&#123;new Date().getTime()&#125;-$&#123;this.guid()&#125;.$&#123;type&#125;`;</span></span><br><span class=\"line\">    <span class=\"comment\">// formData.append(\"files\", $Blob, storeAs);</span></span><br><span class=\"line\">    <span class=\"comment\">//组建XMLHttpRequest 上传文件</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.cos.sliceUploadFile(&#123;</span><br><span class=\"line\">        Bucket: <span class=\"string\">'your bucket'</span>,</span><br><span class=\"line\">        Region: <span class=\"string\">'your region'</span>,</span><br><span class=\"line\">        Key: storeAs,</span><br><span class=\"line\">        Body: file</span><br><span class=\"line\">      &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">          reject(<span class=\"built_in\">JSON</span>.stringify(err));</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          resolve(url);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n","site":{"data":{}},"excerpt":"","more":"<p>接到产品需求，问能不能将前端上传的图片压缩？像移动端上传图片，一般都是超清、高清图片，大小也有10M，甚至一张图片大小有15M左右，这样大的图片上传到腾讯云或者阿里云（没使用服务器上传图片）一方面上传速度慢，影响体验，另一方面体积太大占空间，图片压缩避免了，网上搜到了很多这方面介绍的<a href=\"https://www.cnblogs.com/stoneniqiu/p/5957356.html\" target=\"_blank\" rel=\"noopener\">网址</a>，大多数都是用canvas来实现（不说了，马上开干）！。</p>\n<h2 id=\"实现过程-10M-gt-200k左右\"><a href=\"#实现过程-10M-gt-200k左右\" class=\"headerlink\" title=\"实现过程 (10M =&gt; 200k左右)\"></a>实现过程 (10M =&gt; 200k左右)</h2><h3 id=\"1-图片裁剪\"><a href=\"#1-图片裁剪\" class=\"headerlink\" title=\"1. 图片裁剪\"></a>1. 图片裁剪</h3><p>大体的思路是将图片抽样显示在canvas上，然后用通过<code>canvas.toDataURL</code>方法得到base64字符串来实现压缩。上代码！！！<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> file: &#123;&#125; = e.target.files[<span class=\"number\">0</span>]; <span class=\"comment\">// 通过input元素触发的change事件</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> reader = <span class=\"keyword\">new</span> FileReader(),</span><br><span class=\"line\">img = <span class=\"keyword\">new</span> Image();</span><br><span class=\"line\"><span class=\"comment\">// 缩放图片需要的canvas</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> canvas = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'canvas'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> context = canvas.getContext(<span class=\"string\">'2d'</span>);</span><br><span class=\"line\">reader.readAsDataURL(file);</span><br><span class=\"line\"><span class=\"comment\">// base64地址图片加载完毕后</span></span><br><span class=\"line\">img.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"comment\">// 图片原始尺寸</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> originWidth = <span class=\"keyword\">this</span>[<span class=\"string\">'width'</span>];</span><br><span class=\"line\">  <span class=\"keyword\">const</span> originHeight = <span class=\"keyword\">this</span>[<span class=\"string\">'height'</span>];</span><br><span class=\"line\">  <span class=\"comment\">// 最大尺寸限制</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> maxWidth = <span class=\"number\">750</span>, maxHeight = <span class=\"number\">400</span>;</span><br><span class=\"line\">  <span class=\"comment\">// 目标尺寸</span></span><br><span class=\"line\">  <span class=\"keyword\">let</span> targetWidth = originWidth, targetHeight = originHeight;</span><br><span class=\"line\">  <span class=\"comment\">// 图片尺寸超过750x400的限制</span></span><br><span class=\"line\">  <span class=\"keyword\">if</span> (originWidth &gt; maxWidth || originHeight &gt; maxHeight) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (originWidth / originHeight &gt; maxWidth / maxHeight) &#123;</span><br><span class=\"line\">      <span class=\"comment\">// 更宽，按照宽度限定尺寸</span></span><br><span class=\"line\">      targetWidth = maxWidth;</span><br><span class=\"line\">      targetHeight = <span class=\"built_in\">Math</span>.round(maxWidth * (originHeight / originWidth));</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">      targetHeight = maxHeight;</span><br><span class=\"line\">      targetWidth = <span class=\"built_in\">Math</span>.round(maxHeight * (originWidth / originHeight));</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// canvas对图片进行缩放</span></span><br><span class=\"line\">  canvas.width = targetWidth;</span><br><span class=\"line\">  canvas.height = targetHeight;</span><br><span class=\"line\">  <span class=\"comment\">// 清除画布</span></span><br><span class=\"line\">  context.clearRect(<span class=\"number\">0</span>, <span class=\"number\">0</span>, targetWidth, targetHeight);</span><br><span class=\"line\">  <span class=\"comment\">// 图片压缩</span></span><br><span class=\"line\">  context.drawImage(img, <span class=\"number\">0</span>, <span class=\"number\">0</span>, targetWidth, targetHeight);</span><br><span class=\"line\">  <span class=\"comment\">// canvas转为blob并上传</span></span><br><span class=\"line\">  <span class=\"comment\">// * 很多PC、手机浏览器不支持toBlob方法，如Safari*</span></span><br><span class=\"line\">  <span class=\"comment\">// 不推荐使用toBlob方法</span></span><br><span class=\"line\">  <span class=\"comment\">// canvas.toBlob(function($Blob) &#123;</span></span><br><span class=\"line\">  <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\">  <span class=\"keyword\">const</span> dataUrl = canvas.toDataURL(<span class=\"string\">'image/jpeg'</span>);</span><br><span class=\"line\">  updateImgForBase64(dataUrl);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">reader.onload = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e</span>) </span>&#123;</span><br><span class=\"line\">    img.src = e.target[<span class=\"string\">'result'</span>];</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure></p>\n<h3 id=\"2-上传到腾讯云\"><a href=\"#2-上传到腾讯云\" class=\"headerlink\" title=\"2. 上传到腾讯云\"></a>2. 上传到腾讯云</h3><p>项目中图片是保存在腾讯云中，这里就需要用到<a href=\"https://cloud.tencent.com/document/product/436/11459\" target=\"_blank\" rel=\"noopener\">腾讯JavaScript SDK</a>，按照SDK文档去新建存储桶获取Bucket、Region，直接上代码：<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">updateImgForBase64(img: string, <span class=\"attr\">type</span>: string = <span class=\"string\">'jpeg'</span>): <span class=\"built_in\">Promise</span>&lt;any&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> vm = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> storeAs = <span class=\"string\">`avatar/<span class=\"subst\">$&#123;<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime()&#125;</span>-<span class=\"subst\">$&#123;<span class=\"keyword\">this</span>.guid()&#125;</span>.<span class=\"subst\">$&#123;type&#125;</span>`</span>;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> dataURLtoFile: <span class=\"built_in\">Function</span> = <span class=\"function\">(<span class=\"params\">dataurl, filename</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> arr = dataurl.split(<span class=\"string\">','</span>), mime = arr[<span class=\"number\">0</span>].match(<span class=\"regexp\">/:(.*?);/</span>)[<span class=\"number\">1</span>];</span><br><span class=\"line\">      <span class=\"keyword\">const</span> bstr = atob(arr[<span class=\"number\">1</span>]);</span><br><span class=\"line\">      <span class=\"keyword\">let</span> n = bstr.length;</span><br><span class=\"line\">      <span class=\"keyword\">const</span> u8arr = <span class=\"keyword\">new</span> <span class=\"built_in\">Uint8Array</span>(n);</span><br><span class=\"line\">      <span class=\"keyword\">while</span> (n--) &#123;</span><br><span class=\"line\">        u8arr[n] = bstr.charCodeAt(n);</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> File([u8arr], filename, &#123;<span class=\"attr\">type</span>: mime&#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"keyword\">const</span> file = dataURLtoFile(img, type);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">// function getBlobBydataURI(dataURI, type) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   var binary = atob(dataURI.split(',')[1]);</span></span><br><span class=\"line\">    <span class=\"comment\">//   var array = [];</span></span><br><span class=\"line\">    <span class=\"comment\">//   for (var i = 0; i &lt; binary.length; i++) &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//     array.push(binary.charCodeAt(i));</span></span><br><span class=\"line\">    <span class=\"comment\">//   &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">//   return new Blob([new Uint8Array(array)], &#123;type: type&#125;);</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;</span></span><br><span class=\"line\">    <span class=\"comment\">//</span></span><br><span class=\"line\">    <span class=\"comment\">// /**</span></span><br><span class=\"line\">    <span class=\"comment\">//  * 上传  formData.append(\"files\", $Blob, storeAs);对iOS系统不支持</span></span><br><span class=\"line\">    <span class=\"comment\">//  */</span></span><br><span class=\"line\">    <span class=\"comment\">//   //base64 转 blob</span></span><br><span class=\"line\">    <span class=\"comment\">// let $Blob = getBlobBydataURI(img, 'image/jpeg');</span></span><br><span class=\"line\">    <span class=\"comment\">// let formData = new FormData();</span></span><br><span class=\"line\">    <span class=\"comment\">// let storeAs = `documents/$&#123;new Date().getTime()&#125;-$&#123;this.guid()&#125;.$&#123;type&#125;`;</span></span><br><span class=\"line\">    <span class=\"comment\">// formData.append(\"files\", $Blob, storeAs);</span></span><br><span class=\"line\">    <span class=\"comment\">//组建XMLHttpRequest 上传文件</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\">(<span class=\"params\">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      <span class=\"keyword\">this</span>.cos.sliceUploadFile(&#123;</span><br><span class=\"line\">        Bucket: <span class=\"string\">'your bucket'</span>,</span><br><span class=\"line\">        Region: <span class=\"string\">'your region'</span>,</span><br><span class=\"line\">        Key: storeAs,</span><br><span class=\"line\">        Body: file</span><br><span class=\"line\">      &#125;, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">err, data</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (err) &#123;</span><br><span class=\"line\">          reject(<span class=\"built_in\">JSON</span>.stringify(err));</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">          resolve(url);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  &#125;</span><br></pre></td></tr></table></figure></p>\n"},{"title":"前端实现在线预览pdf、word、xls、ppt等文件","_content":"\n## 1、前端实现pdf文件在线预览功能\n### 方式一: 通过a标签href属性实现\npdf文件理论上可以在浏览器直接打开预览但是需要打开新页面。在仅仅是预览pdf文件且UI要求不高的情况下可以直接通过a标签href属性实现预览\n```html\n<a href=\"文档地址\"></a>\n```\n\n### 方式二: 通过jquery插件jquery.media.js实现\n这个插件可以实现pdf预览功能（包括其他各种媒体文件）但是对word等类型的文件无能为力。\n实现方式：\n```html\n<script type=\"text/javascript\" src=\"jquery-1.7.1.min.js\"></script>  \n<script type=\"text/javascript\" src=\"jquery.media.js\"></script>\nhtml结构：\n      <body>\n          <div id=\"handout_wrap_inner\"></div>\n      </body>\n调用方式：\n<script type=\"text/javascript\">  \n $('#handout_wrap_inner').media({\n\t\twidth: '100%',\n\t\theight: '100%',\n\t\tautoplay: true,\n        src:'http://storage.xuetangx.com/public_assets/xuetangx/PDF/PlayerAPI_v1.0.6.pdf',\n            }); \n</script>\n```\n### 方式三: 直接通过页面内嵌iframe\n```html\n$(\"<iframe src='\"+ this.previewUrl +\"' width='100%' height='362px' frameborder='1'>\").appendTo($(\".video-handouts-preview\"));\n此外还可以在iframe标签之间提供一个提示类似这样\n<iframe :src=\"previewUrl\" width=\"100%\" height=\"100%\">\n\nThis browser does not support PDFs. Please download the PDF to view it: <a :href=\"previewUrl\">Download PDF</a>\n\n</iframe>\n```\n### 方式四: 通过标签嵌入内容\n```html\n<embed :src=\"previewUrl\" type=\"application/pdf\" width=\"100%\" height=\"100%\">\n此标签h5特性中包含四个属性：高、宽、类型、预览文件src！\n与< iframe > < / iframe > 不同，这个标签是自闭合的的，也就是说如果浏览器不支持PDF的嵌入，那么这个标签的内容什么都看不到！\n\n```\n### 方式五: 标签和iframe使用差别较小\n```html\n<object :src=\"previewUrl\" width=\"100%\" height=\"100%\">\n\nThis browser does not support PDFs. Please download the PDF to view it: <a :href=\"previewUrl\">Download PDF</a>\n\n</object>\n```\n除方式二以外其他都是直接通过标签将内容引入页面实现预览\n### 方式六: PDFObject\nPDFObject实际上也是通过标签实现的直接上代码\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Show PDF</title>\n    <meta charset=\"utf-8\" />\n    <script type=\"text/javascript\" src='pdfobject.min.js'></script>\n    <style type=\"text/css\">\n        html,body,#pdf_viewer{\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"pdf_viewer\"></div>\n</body>\n<script type=\"text/javascript\">\n    if(PDFObject.supportsPDFs){\n        // PDF嵌入到网页\n        PDFObject.embed(\"index.pdf\", \"#pdf_viewer\" );\n    } else {\n        location.href = \"/canvas\";\n    }\n    \n    // 还可以通过以下代码进行判断是否支持PDFObject预览\n    if(PDFObject.supportsPDFs){\n       console.log(\"Yay, this browser supports inline PDFs.\");\n    } else {\n       console.log(\"Boo, inline PDFs are not supported by this browser\");\n    }\n</script>\n</html>\n```\n\n### 方式七: PDF.js ([简单粗暴](../../../../2018/05/17/预览PDF文件/))\nPDF.js可以实现在html下直接浏览pdf文档，是一款开源的pdf文档读取解析插件，非常强大，能将PDF文件渲染成Canvas。PDF.js主要包含两个库文件，一个pdf.js和一个pdf.worker.js，一个负责API解析，一个负责核心解析。\n\n## 2、word、xls、ppt文件在线预览功能\nword、ppt、xls文件实现在线预览的方式比较简单可以直接通过调用微软的在线预览功能实现 (预览前提：资源必须是公共可访问的)\n```html\n<iframe src='https://view.officeapps.live.com/op/view.aspx?src=http://storage.xuetangx.com/public_assets/xuetangx/PDF/1.xls' width='100%' height='100%' frameborder='1'>\n</iframe>\n/*src就是要实现预览的文件地址*/\n/*具体文档看这微软接口文档*/\n/*补充：google的文档在线预览实现同微软（资源必须是公共可访问的）*/\n<iframe :src=\"'https://docs.google.com/viewer?url=\"fileurl\"></iframe>\n```\n## 3、word文件\nXDOC可以实现预览以DataURI表示的DOC文档，此外XDOC还可以实现文本、带参数文本、html文本、json文本、公文等在线预览，具体实现方法请看官方文档下面这种方式可以实现快速预览word但是对文件使用的编辑器可能会有一些限制\n```html\n<a href=\"http://www.xdocin.com/xdoc?_func=to&amp;_format=html&amp;_cache=1&amp;_xdoc=http://www.xdocin.com/demo/demo.docx\" target=\"_blank\" rel=\"nofollow\">XDOC</a>\n```\n## 4、excel文件\n目前excel文件已经有了类似pdf.js那样的解析sheet.js\n## 总结\n1、免费纯前端方式实现在线预览word、excel、ppt最优选择微软在线预览（不可编辑）\n2、利用后端将文件转为图片，前端以图片形式预览（可行方案）\n3、购买在线预览服务例如百度DOC文档服务、永中、I DOC VIEW等\n\n[转载](https://juejin.im/post/5a7badf26fb9a063353198a1)","source":"_posts/前端预览文件.md","raw":"---\ntitle: 前端实现在线预览pdf、word、xls、ppt等文件\n---\n\n## 1、前端实现pdf文件在线预览功能\n### 方式一: 通过a标签href属性实现\npdf文件理论上可以在浏览器直接打开预览但是需要打开新页面。在仅仅是预览pdf文件且UI要求不高的情况下可以直接通过a标签href属性实现预览\n```html\n<a href=\"文档地址\"></a>\n```\n\n### 方式二: 通过jquery插件jquery.media.js实现\n这个插件可以实现pdf预览功能（包括其他各种媒体文件）但是对word等类型的文件无能为力。\n实现方式：\n```html\n<script type=\"text/javascript\" src=\"jquery-1.7.1.min.js\"></script>  \n<script type=\"text/javascript\" src=\"jquery.media.js\"></script>\nhtml结构：\n      <body>\n          <div id=\"handout_wrap_inner\"></div>\n      </body>\n调用方式：\n<script type=\"text/javascript\">  \n $('#handout_wrap_inner').media({\n\t\twidth: '100%',\n\t\theight: '100%',\n\t\tautoplay: true,\n        src:'http://storage.xuetangx.com/public_assets/xuetangx/PDF/PlayerAPI_v1.0.6.pdf',\n            }); \n</script>\n```\n### 方式三: 直接通过页面内嵌iframe\n```html\n$(\"<iframe src='\"+ this.previewUrl +\"' width='100%' height='362px' frameborder='1'>\").appendTo($(\".video-handouts-preview\"));\n此外还可以在iframe标签之间提供一个提示类似这样\n<iframe :src=\"previewUrl\" width=\"100%\" height=\"100%\">\n\nThis browser does not support PDFs. Please download the PDF to view it: <a :href=\"previewUrl\">Download PDF</a>\n\n</iframe>\n```\n### 方式四: 通过标签嵌入内容\n```html\n<embed :src=\"previewUrl\" type=\"application/pdf\" width=\"100%\" height=\"100%\">\n此标签h5特性中包含四个属性：高、宽、类型、预览文件src！\n与< iframe > < / iframe > 不同，这个标签是自闭合的的，也就是说如果浏览器不支持PDF的嵌入，那么这个标签的内容什么都看不到！\n\n```\n### 方式五: 标签和iframe使用差别较小\n```html\n<object :src=\"previewUrl\" width=\"100%\" height=\"100%\">\n\nThis browser does not support PDFs. Please download the PDF to view it: <a :href=\"previewUrl\">Download PDF</a>\n\n</object>\n```\n除方式二以外其他都是直接通过标签将内容引入页面实现预览\n### 方式六: PDFObject\nPDFObject实际上也是通过标签实现的直接上代码\n```html\n<!DOCTYPE html>\n<html>\n<head>\n    <title>Show PDF</title>\n    <meta charset=\"utf-8\" />\n    <script type=\"text/javascript\" src='pdfobject.min.js'></script>\n    <style type=\"text/css\">\n        html,body,#pdf_viewer{\n            width: 100%;\n            height: 100%;\n            margin: 0;\n            padding: 0;\n        }\n    </style>\n</head>\n<body>\n    <div id=\"pdf_viewer\"></div>\n</body>\n<script type=\"text/javascript\">\n    if(PDFObject.supportsPDFs){\n        // PDF嵌入到网页\n        PDFObject.embed(\"index.pdf\", \"#pdf_viewer\" );\n    } else {\n        location.href = \"/canvas\";\n    }\n    \n    // 还可以通过以下代码进行判断是否支持PDFObject预览\n    if(PDFObject.supportsPDFs){\n       console.log(\"Yay, this browser supports inline PDFs.\");\n    } else {\n       console.log(\"Boo, inline PDFs are not supported by this browser\");\n    }\n</script>\n</html>\n```\n\n### 方式七: PDF.js ([简单粗暴](../../../../2018/05/17/预览PDF文件/))\nPDF.js可以实现在html下直接浏览pdf文档，是一款开源的pdf文档读取解析插件，非常强大，能将PDF文件渲染成Canvas。PDF.js主要包含两个库文件，一个pdf.js和一个pdf.worker.js，一个负责API解析，一个负责核心解析。\n\n## 2、word、xls、ppt文件在线预览功能\nword、ppt、xls文件实现在线预览的方式比较简单可以直接通过调用微软的在线预览功能实现 (预览前提：资源必须是公共可访问的)\n```html\n<iframe src='https://view.officeapps.live.com/op/view.aspx?src=http://storage.xuetangx.com/public_assets/xuetangx/PDF/1.xls' width='100%' height='100%' frameborder='1'>\n</iframe>\n/*src就是要实现预览的文件地址*/\n/*具体文档看这微软接口文档*/\n/*补充：google的文档在线预览实现同微软（资源必须是公共可访问的）*/\n<iframe :src=\"'https://docs.google.com/viewer?url=\"fileurl\"></iframe>\n```\n## 3、word文件\nXDOC可以实现预览以DataURI表示的DOC文档，此外XDOC还可以实现文本、带参数文本、html文本、json文本、公文等在线预览，具体实现方法请看官方文档下面这种方式可以实现快速预览word但是对文件使用的编辑器可能会有一些限制\n```html\n<a href=\"http://www.xdocin.com/xdoc?_func=to&amp;_format=html&amp;_cache=1&amp;_xdoc=http://www.xdocin.com/demo/demo.docx\" target=\"_blank\" rel=\"nofollow\">XDOC</a>\n```\n## 4、excel文件\n目前excel文件已经有了类似pdf.js那样的解析sheet.js\n## 总结\n1、免费纯前端方式实现在线预览word、excel、ppt最优选择微软在线预览（不可编辑）\n2、利用后端将文件转为图片，前端以图片形式预览（可行方案）\n3、购买在线预览服务例如百度DOC文档服务、永中、I DOC VIEW等\n\n[转载](https://juejin.im/post/5a7badf26fb9a063353198a1)","slug":"前端预览文件","published":1,"date":"2018-05-17T08:33:37.000Z","updated":"2018-05-17T08:33:37.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjkmaz65r0005fkq344ifepav","content":"<h2 id=\"1、前端实现pdf文件在线预览功能\"><a href=\"#1、前端实现pdf文件在线预览功能\" class=\"headerlink\" title=\"1、前端实现pdf文件在线预览功能\"></a>1、前端实现pdf文件在线预览功能</h2><h3 id=\"方式一-通过a标签href属性实现\"><a href=\"#方式一-通过a标签href属性实现\" class=\"headerlink\" title=\"方式一: 通过a标签href属性实现\"></a>方式一: 通过a标签href属性实现</h3><p>pdf文件理论上可以在浏览器直接打开预览但是需要打开新页面。在仅仅是预览pdf文件且UI要求不高的情况下可以直接通过a标签href属性实现预览<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"文档地址\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"方式二-通过jquery插件jquery-media-js实现\"><a href=\"#方式二-通过jquery插件jquery-media-js实现\" class=\"headerlink\" title=\"方式二: 通过jquery插件jquery.media.js实现\"></a>方式二: 通过jquery插件jquery.media.js实现</h3><p>这个插件可以实现pdf预览功能（包括其他各种媒体文件）但是对word等类型的文件无能为力。<br>实现方式：<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"jquery-1.7.1.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"jquery.media.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">html结构：</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"handout_wrap_inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">调用方式：</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\">  </span></span><br><span class=\"line\"><span class=\"javascript\"> $(<span class=\"string\">'#handout_wrap_inner'</span>).media(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">\t\twidth: <span class=\"string\">'100%'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">\t\theight: <span class=\"string\">'100%'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">\t\tautoplay: <span class=\"literal\">true</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        src:<span class=\"string\">'http://storage.xuetangx.com/public_assets/xuetangx/PDF/PlayerAPI_v1.0.6.pdf'</span>,</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;); </span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"方式三-直接通过页面内嵌iframe\"><a href=\"#方式三-直接通过页面内嵌iframe\" class=\"headerlink\" title=\"方式三: 直接通过页面内嵌iframe\"></a>方式三: 直接通过页面内嵌iframe</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(\"<span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">src</span>=<span class=\"string\">'\"+ this.previewUrl +\"'</span> <span class=\"attr\">width</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">height</span>=<span class=\"string\">'362px'</span> <span class=\"attr\">frameborder</span>=<span class=\"string\">'1'</span>&gt;</span>\").appendTo($(\".video-handouts-preview\"));</span><br><span class=\"line\">此外还可以在iframe标签之间提供一个提示类似这样</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"previewUrl\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">This browser does not support PDFs. Please download the PDF to view it: <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:href</span>=<span class=\"string\">\"previewUrl\"</span>&gt;</span>Download PDF<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"方式四-通过标签嵌入内容\"><a href=\"#方式四-通过标签嵌入内容\" class=\"headerlink\" title=\"方式四: 通过标签嵌入内容\"></a>方式四: 通过标签嵌入内容</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">embed</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"previewUrl\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"application/pdf\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span>&gt;</span></span><br><span class=\"line\">此标签h5特性中包含四个属性：高、宽、类型、预览文件src！</span><br><span class=\"line\">与<span class=\"tag\">&lt; <span class=\"attr\">iframe</span> &gt;</span> <span class=\"tag\">&lt; / <span class=\"attr\">iframe</span> &gt;</span> 不同，这个标签是自闭合的的，也就是说如果浏览器不支持PDF的嵌入，那么这个标签的内容什么都看不到！</span><br></pre></td></tr></table></figure>\n<h3 id=\"方式五-标签和iframe使用差别较小\"><a href=\"#方式五-标签和iframe使用差别较小\" class=\"headerlink\" title=\"方式五: 标签和iframe使用差别较小\"></a>方式五: 标签和iframe使用差别较小</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">object</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"previewUrl\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">This browser does not support PDFs. Please download the PDF to view it: <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:href</span>=<span class=\"string\">\"previewUrl\"</span>&gt;</span>Download PDF<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">object</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>除方式二以外其他都是直接通过标签将内容引入页面实现预览</p>\n<h3 id=\"方式六-PDFObject\"><a href=\"#方式六-PDFObject\" class=\"headerlink\" title=\"方式六: PDFObject\"></a>方式六: PDFObject</h3><p>PDFObject实际上也是通过标签实现的直接上代码<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Show PDF<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">'pdfobject.min.js'</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-tag\">html</span>,<span class=\"selector-tag\">body</span>,<span class=\"selector-id\">#pdf_viewer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 100%;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100%;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">            padding: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"pdf_viewer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">if</span>(PDFObject.supportsPDFs)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// PDF嵌入到网页</span></span></span><br><span class=\"line\"><span class=\"javascript\">        PDFObject.embed(<span class=\"string\">\"index.pdf\"</span>, <span class=\"string\">\"#pdf_viewer\"</span> );</span></span><br><span class=\"line\"><span class=\"javascript\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        location.href = <span class=\"string\">\"/canvas\"</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 还可以通过以下代码进行判断是否支持PDFObject预览</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">if</span>(PDFObject.supportsPDFs)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Yay, this browser supports inline PDFs.\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Boo, inline PDFs are not supported by this browser\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"方式七-PDF-js-简单粗暴\"><a href=\"#方式七-PDF-js-简单粗暴\" class=\"headerlink\" title=\"方式七: PDF.js (简单粗暴)\"></a>方式七: PDF.js (<a href=\"../../../../2018/05/17/预览PDF文件/\">简单粗暴</a>)</h3><p>PDF.js可以实现在html下直接浏览pdf文档，是一款开源的pdf文档读取解析插件，非常强大，能将PDF文件渲染成Canvas。PDF.js主要包含两个库文件，一个pdf.js和一个pdf.worker.js，一个负责API解析，一个负责核心解析。</p>\n<h2 id=\"2、word、xls、ppt文件在线预览功能\"><a href=\"#2、word、xls、ppt文件在线预览功能\" class=\"headerlink\" title=\"2、word、xls、ppt文件在线预览功能\"></a>2、word、xls、ppt文件在线预览功能</h2><p>word、ppt、xls文件实现在线预览的方式比较简单可以直接通过调用微软的在线预览功能实现 (预览前提：资源必须是公共可访问的)<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">src</span>=<span class=\"string\">'https://view.officeapps.live.com/op/view.aspx?src=http://storage.xuetangx.com/public_assets/xuetangx/PDF/1.xls'</span> <span class=\"attr\">width</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">height</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">frameborder</span>=<span class=\"string\">'1'</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br><span class=\"line\">/*src就是要实现预览的文件地址*/</span><br><span class=\"line\">/*具体文档看这微软接口文档*/</span><br><span class=\"line\">/*补充：google的文档在线预览实现同微软（资源必须是公共可访问的）*/</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"'https://docs.google.com/viewer?url=\"</span><span class=\"attr\">fileurl</span>\"&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3、word文件\"><a href=\"#3、word文件\" class=\"headerlink\" title=\"3、word文件\"></a>3、word文件</h2><p>XDOC可以实现预览以DataURI表示的DOC文档，此外XDOC还可以实现文本、带参数文本、html文本、json文本、公文等在线预览，具体实现方法请看官方文档下面这种方式可以实现快速预览word但是对文件使用的编辑器可能会有一些限制<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"http://www.xdocin.com/xdoc?_func=to&amp;amp;_format=html&amp;amp;_cache=1&amp;amp;_xdoc=http://www.xdocin.com/demo/demo.docx\"</span> <span class=\"attr\">target</span>=<span class=\"string\">\"_blank\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"nofollow\"</span>&gt;</span>XDOC<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4、excel文件\"><a href=\"#4、excel文件\" class=\"headerlink\" title=\"4、excel文件\"></a>4、excel文件</h2><p>目前excel文件已经有了类似pdf.js那样的解析sheet.js</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>1、免费纯前端方式实现在线预览word、excel、ppt最优选择微软在线预览（不可编辑）<br>2、利用后端将文件转为图片，前端以图片形式预览（可行方案）<br>3、购买在线预览服务例如百度DOC文档服务、永中、I DOC VIEW等</p>\n<p><a href=\"https://juejin.im/post/5a7badf26fb9a063353198a1\" target=\"_blank\" rel=\"noopener\">转载</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"1、前端实现pdf文件在线预览功能\"><a href=\"#1、前端实现pdf文件在线预览功能\" class=\"headerlink\" title=\"1、前端实现pdf文件在线预览功能\"></a>1、前端实现pdf文件在线预览功能</h2><h3 id=\"方式一-通过a标签href属性实现\"><a href=\"#方式一-通过a标签href属性实现\" class=\"headerlink\" title=\"方式一: 通过a标签href属性实现\"></a>方式一: 通过a标签href属性实现</h3><p>pdf文件理论上可以在浏览器直接打开预览但是需要打开新页面。在仅仅是预览pdf文件且UI要求不高的情况下可以直接通过a标签href属性实现预览<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"文档地址\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"方式二-通过jquery插件jquery-media-js实现\"><a href=\"#方式二-通过jquery插件jquery-media-js实现\" class=\"headerlink\" title=\"方式二: 通过jquery插件jquery.media.js实现\"></a>方式二: 通过jquery插件jquery.media.js实现</h3><p>这个插件可以实现pdf预览功能（包括其他各种媒体文件）但是对word等类型的文件无能为力。<br>实现方式：<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"jquery-1.7.1.min.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span>  </span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">\"jquery.media.js\"</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">html结构：</span><br><span class=\"line\">      <span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">          <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"handout_wrap_inner\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">      <span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">调用方式：</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\">  </span></span><br><span class=\"line\"><span class=\"javascript\"> $(<span class=\"string\">'#handout_wrap_inner'</span>).media(&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">\t\twidth: <span class=\"string\">'100%'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">\t\theight: <span class=\"string\">'100%'</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">\t\tautoplay: <span class=\"literal\">true</span>,</span></span><br><span class=\"line\"><span class=\"javascript\">        src:<span class=\"string\">'http://storage.xuetangx.com/public_assets/xuetangx/PDF/PlayerAPI_v1.0.6.pdf'</span>,</span></span><br><span class=\"line\"><span class=\"undefined\">            &#125;); </span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"方式三-直接通过页面内嵌iframe\"><a href=\"#方式三-直接通过页面内嵌iframe\" class=\"headerlink\" title=\"方式三: 直接通过页面内嵌iframe\"></a>方式三: 直接通过页面内嵌iframe</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\">$(\"<span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">src</span>=<span class=\"string\">'\"+ this.previewUrl +\"'</span> <span class=\"attr\">width</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">height</span>=<span class=\"string\">'362px'</span> <span class=\"attr\">frameborder</span>=<span class=\"string\">'1'</span>&gt;</span>\").appendTo($(\".video-handouts-preview\"));</span><br><span class=\"line\">此外还可以在iframe标签之间提供一个提示类似这样</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"previewUrl\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">This browser does not support PDFs. Please download the PDF to view it: <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:href</span>=<span class=\"string\">\"previewUrl\"</span>&gt;</span>Download PDF<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"方式四-通过标签嵌入内容\"><a href=\"#方式四-通过标签嵌入内容\" class=\"headerlink\" title=\"方式四: 通过标签嵌入内容\"></a>方式四: 通过标签嵌入内容</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">embed</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"previewUrl\"</span> <span class=\"attr\">type</span>=<span class=\"string\">\"application/pdf\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span>&gt;</span></span><br><span class=\"line\">此标签h5特性中包含四个属性：高、宽、类型、预览文件src！</span><br><span class=\"line\">与<span class=\"tag\">&lt; <span class=\"attr\">iframe</span> &gt;</span> <span class=\"tag\">&lt; / <span class=\"attr\">iframe</span> &gt;</span> 不同，这个标签是自闭合的的，也就是说如果浏览器不支持PDF的嵌入，那么这个标签的内容什么都看不到！</span><br></pre></td></tr></table></figure>\n<h3 id=\"方式五-标签和iframe使用差别较小\"><a href=\"#方式五-标签和iframe使用差别较小\" class=\"headerlink\" title=\"方式五: 标签和iframe使用差别较小\"></a>方式五: 标签和iframe使用差别较小</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">object</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"previewUrl\"</span> <span class=\"attr\">width</span>=<span class=\"string\">\"100%\"</span> <span class=\"attr\">height</span>=<span class=\"string\">\"100%\"</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\">This browser does not support PDFs. Please download the PDF to view it: <span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">:href</span>=<span class=\"string\">\"previewUrl\"</span>&gt;</span>Download PDF<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">object</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>除方式二以外其他都是直接通过标签将内容引入页面实现预览</p>\n<h3 id=\"方式六-PDFObject\"><a href=\"#方式六-PDFObject\" class=\"headerlink\" title=\"方式六: PDFObject\"></a>方式六: PDFObject</h3><p>PDFObject实际上也是通过标签实现的直接上代码<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;!DOCTYPE html&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">html</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">title</span>&gt;</span>Show PDF<span class=\"tag\">&lt;/<span class=\"name\">title</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">meta</span> <span class=\"attr\">charset</span>=<span class=\"string\">\"utf-8\"</span> /&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span> <span class=\"attr\">src</span>=<span class=\"string\">'pdfobject.min.js'</span>&gt;</span><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">style</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/css\"</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"css\">        <span class=\"selector-tag\">html</span>,<span class=\"selector-tag\">body</span>,<span class=\"selector-id\">#pdf_viewer</span>&#123;</span></span><br><span class=\"line\"><span class=\"undefined\">            width: 100%;</span></span><br><span class=\"line\"><span class=\"undefined\">            height: 100%;</span></span><br><span class=\"line\"><span class=\"undefined\">            margin: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">            padding: 0;</span></span><br><span class=\"line\"><span class=\"undefined\">        &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span><span class=\"tag\">&lt;/<span class=\"name\">style</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">head</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"pdf_viewer\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">body</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">script</span> <span class=\"attr\">type</span>=<span class=\"string\">\"text/javascript\"</span>&gt;</span><span class=\"undefined\"></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">if</span>(PDFObject.supportsPDFs)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        <span class=\"comment\">// PDF嵌入到网页</span></span></span><br><span class=\"line\"><span class=\"javascript\">        PDFObject.embed(<span class=\"string\">\"index.pdf\"</span>, <span class=\"string\">\"#pdf_viewer\"</span> );</span></span><br><span class=\"line\"><span class=\"javascript\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">        location.href = <span class=\"string\">\"/canvas\"</span>;</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\">    </span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"comment\">// 还可以通过以下代码进行判断是否支持PDFObject预览</span></span></span><br><span class=\"line\"><span class=\"javascript\">    <span class=\"keyword\">if</span>(PDFObject.supportsPDFs)&#123;</span></span><br><span class=\"line\"><span class=\"javascript\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Yay, this browser supports inline PDFs.\"</span>);</span></span><br><span class=\"line\"><span class=\"javascript\">    &#125; <span class=\"keyword\">else</span> &#123;</span></span><br><span class=\"line\"><span class=\"javascript\">       <span class=\"built_in\">console</span>.log(<span class=\"string\">\"Boo, inline PDFs are not supported by this browser\"</span>);</span></span><br><span class=\"line\"><span class=\"undefined\">    &#125;</span></span><br><span class=\"line\"><span class=\"undefined\"></span><span class=\"tag\">&lt;/<span class=\"name\">script</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h3 id=\"方式七-PDF-js-简单粗暴\"><a href=\"#方式七-PDF-js-简单粗暴\" class=\"headerlink\" title=\"方式七: PDF.js (简单粗暴)\"></a>方式七: PDF.js (<a href=\"../../../../2018/05/17/预览PDF文件/\">简单粗暴</a>)</h3><p>PDF.js可以实现在html下直接浏览pdf文档，是一款开源的pdf文档读取解析插件，非常强大，能将PDF文件渲染成Canvas。PDF.js主要包含两个库文件，一个pdf.js和一个pdf.worker.js，一个负责API解析，一个负责核心解析。</p>\n<h2 id=\"2、word、xls、ppt文件在线预览功能\"><a href=\"#2、word、xls、ppt文件在线预览功能\" class=\"headerlink\" title=\"2、word、xls、ppt文件在线预览功能\"></a>2、word、xls、ppt文件在线预览功能</h2><p>word、ppt、xls文件实现在线预览的方式比较简单可以直接通过调用微软的在线预览功能实现 (预览前提：资源必须是公共可访问的)<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">src</span>=<span class=\"string\">'https://view.officeapps.live.com/op/view.aspx?src=http://storage.xuetangx.com/public_assets/xuetangx/PDF/1.xls'</span> <span class=\"attr\">width</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">height</span>=<span class=\"string\">'100%'</span> <span class=\"attr\">frameborder</span>=<span class=\"string\">'1'</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br><span class=\"line\">/*src就是要实现预览的文件地址*/</span><br><span class=\"line\">/*具体文档看这微软接口文档*/</span><br><span class=\"line\">/*补充：google的文档在线预览实现同微软（资源必须是公共可访问的）*/</span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">iframe</span> <span class=\"attr\">:src</span>=<span class=\"string\">\"'https://docs.google.com/viewer?url=\"</span><span class=\"attr\">fileurl</span>\"&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">iframe</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"3、word文件\"><a href=\"#3、word文件\" class=\"headerlink\" title=\"3、word文件\"></a>3、word文件</h2><p>XDOC可以实现预览以DataURI表示的DOC文档，此外XDOC还可以实现文本、带参数文本、html文本、json文本、公文等在线预览，具体实现方法请看官方文档下面这种方式可以实现快速预览word但是对文件使用的编辑器可能会有一些限制<br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"http://www.xdocin.com/xdoc?_func=to&amp;amp;_format=html&amp;amp;_cache=1&amp;amp;_xdoc=http://www.xdocin.com/demo/demo.docx\"</span> <span class=\"attr\">target</span>=<span class=\"string\">\"_blank\"</span> <span class=\"attr\">rel</span>=<span class=\"string\">\"nofollow\"</span>&gt;</span>XDOC<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<h2 id=\"4、excel文件\"><a href=\"#4、excel文件\" class=\"headerlink\" title=\"4、excel文件\"></a>4、excel文件</h2><p>目前excel文件已经有了类似pdf.js那样的解析sheet.js</p>\n<h2 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h2><p>1、免费纯前端方式实现在线预览word、excel、ppt最优选择微软在线预览（不可编辑）<br>2、利用后端将文件转为图片，前端以图片形式预览（可行方案）<br>3、购买在线预览服务例如百度DOC文档服务、永中、I DOC VIEW等</p>\n<p><a href=\"https://juejin.im/post/5a7badf26fb9a063353198a1\" target=\"_blank\" rel=\"noopener\">转载</a></p>\n"},{"title":"PDF.js预览文件","_content":"网上找到很多前端实现文件预览方法，但都无法解决我的问题，产品需求中将文件上传到腾讯云的对象存储，返回一个URL，这个URL无法在网页中预览，浏览器将这个URL直接本地下载文件（下载文件下面说）,最后只能用PDF.js，这是一个开源的js库，直接将PDF文件渲染成canvas，PDF.js框架的魅力所在，为其为HTML5实现的，无需任何本地支持，而且对浏览器的兼容性也是比较好，要求只有一个：浏览器支持HTML5就好了！（不过对于低版本的IE，就只能节哀了！）.不多说，直接贴代码(angular5.0开发):\n\n在线演示地址：http://mozilla.github.com/pdf.js/web/viewer.html\n\nDemo地址：http://mozilla.github.io/pdf.js/examples/\n\nPDF.js可在官网下载  地址：http://mozilla.github.io/pdf.js/\n```html\n  <canvas id=\"the-canvas\" class=\"the-canvas\" style=\"position: absolute;\n    left: 0;\n    right: 0;\n    margin: auto;\"></canvas>\n  <div class=\"m-t\" style=\"position: fixed;\n    right: 40px;\">\n    <button id=\"prev\" nz-button class=\"m-r-md\"><i class=\"anticon anticon-left\"></i>Previous</button>\n    <span class=\"m-r-md\">Page: <span id=\"page_num\"></span> / <span id=\"page_count\"></span></span>\n    <button id=\"next\" nz-button>Next<i class=\"anticon anticon-right\"></i></button>\n  </div>\n\n```\n通过按钮控制页面加载\n```js\n previewPDF(url) {\n    // url 为PDF文件的链接地址;\n    const vm = this;\n    const pdfjsLib = window['pdfjs-dist/build/pdf'];\n    pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';\n\n    let pdfDoc = null,\n      pageNum = 1,\n      pageRendering = false,\n      pageNumPending = null,\n      scale = 1.6,\n      canvas = vm.el.nativeElement.querySelector('.the-canvas'),\n      ctx = canvas['getContext']('2d');\n\n    function renderPage(num) {\n      pageRendering = true;\n      pdfDoc.getPage(num).then(function (page) {\n        const viewport = page.getViewport(scale);\n        canvas['height'] = viewport.height;\n        canvas['width'] = viewport.width;\n\n        const renderContext = {\n          canvasContext: ctx,\n          viewport: viewport\n        };\n        const renderTask = page.render(renderContext);\n\n        renderTask.promise.then(function () {\n          pageRendering = false;\n          if (pageNumPending !== null) {\n            renderPage(pageNumPending);\n            pageNumPending = null;\n          }\n        });\n      });\n      vm.el.nativeElement.querySelector('#page_num').textContent = num;\n    }\n\n    function queueRenderPage(num) {\n      if (pageRendering) {\n        pageNumPending = num;\n      } else {\n        renderPage(num);\n      }\n    }\n\n    function onPrevPage() {\n      if (pageNum <= 1) {\n        return;\n      }\n      pageNum--;\n      queueRenderPage(pageNum);\n    }\n\n    vm.el.nativeElement.querySelector('#prev').addEventListener('click', onPrevPage);\n\n    function onNextPage() {\n      if (pageNum >= pdfDoc.numPages) {\n        return;\n      }\n      pageNum++;\n      queueRenderPage(pageNum);\n    }\n\n    vm.el.nativeElement.querySelector('#next').addEventListener('click', onNextPage);\n\n    pdfjsLib.getDocument(url).then(function (pdfDoc_) {\n      pdfDoc = pdfDoc_;\n      vm.el.nativeElement.querySelector('#page_count').textContent = pdfDoc.numPages;\n      renderPage(pageNum);\n    });\n  }\n```\n\n结果如下图:\n![](/images/pdf.jpg)","source":"_posts/预览PDF文件.md","raw":"---\ntitle: PDF.js预览文件\n---\n网上找到很多前端实现文件预览方法，但都无法解决我的问题，产品需求中将文件上传到腾讯云的对象存储，返回一个URL，这个URL无法在网页中预览，浏览器将这个URL直接本地下载文件（下载文件下面说）,最后只能用PDF.js，这是一个开源的js库，直接将PDF文件渲染成canvas，PDF.js框架的魅力所在，为其为HTML5实现的，无需任何本地支持，而且对浏览器的兼容性也是比较好，要求只有一个：浏览器支持HTML5就好了！（不过对于低版本的IE，就只能节哀了！）.不多说，直接贴代码(angular5.0开发):\n\n在线演示地址：http://mozilla.github.com/pdf.js/web/viewer.html\n\nDemo地址：http://mozilla.github.io/pdf.js/examples/\n\nPDF.js可在官网下载  地址：http://mozilla.github.io/pdf.js/\n```html\n  <canvas id=\"the-canvas\" class=\"the-canvas\" style=\"position: absolute;\n    left: 0;\n    right: 0;\n    margin: auto;\"></canvas>\n  <div class=\"m-t\" style=\"position: fixed;\n    right: 40px;\">\n    <button id=\"prev\" nz-button class=\"m-r-md\"><i class=\"anticon anticon-left\"></i>Previous</button>\n    <span class=\"m-r-md\">Page: <span id=\"page_num\"></span> / <span id=\"page_count\"></span></span>\n    <button id=\"next\" nz-button>Next<i class=\"anticon anticon-right\"></i></button>\n  </div>\n\n```\n通过按钮控制页面加载\n```js\n previewPDF(url) {\n    // url 为PDF文件的链接地址;\n    const vm = this;\n    const pdfjsLib = window['pdfjs-dist/build/pdf'];\n    pdfjsLib.GlobalWorkerOptions.workerSrc = '//mozilla.github.io/pdf.js/build/pdf.worker.js';\n\n    let pdfDoc = null,\n      pageNum = 1,\n      pageRendering = false,\n      pageNumPending = null,\n      scale = 1.6,\n      canvas = vm.el.nativeElement.querySelector('.the-canvas'),\n      ctx = canvas['getContext']('2d');\n\n    function renderPage(num) {\n      pageRendering = true;\n      pdfDoc.getPage(num).then(function (page) {\n        const viewport = page.getViewport(scale);\n        canvas['height'] = viewport.height;\n        canvas['width'] = viewport.width;\n\n        const renderContext = {\n          canvasContext: ctx,\n          viewport: viewport\n        };\n        const renderTask = page.render(renderContext);\n\n        renderTask.promise.then(function () {\n          pageRendering = false;\n          if (pageNumPending !== null) {\n            renderPage(pageNumPending);\n            pageNumPending = null;\n          }\n        });\n      });\n      vm.el.nativeElement.querySelector('#page_num').textContent = num;\n    }\n\n    function queueRenderPage(num) {\n      if (pageRendering) {\n        pageNumPending = num;\n      } else {\n        renderPage(num);\n      }\n    }\n\n    function onPrevPage() {\n      if (pageNum <= 1) {\n        return;\n      }\n      pageNum--;\n      queueRenderPage(pageNum);\n    }\n\n    vm.el.nativeElement.querySelector('#prev').addEventListener('click', onPrevPage);\n\n    function onNextPage() {\n      if (pageNum >= pdfDoc.numPages) {\n        return;\n      }\n      pageNum++;\n      queueRenderPage(pageNum);\n    }\n\n    vm.el.nativeElement.querySelector('#next').addEventListener('click', onNextPage);\n\n    pdfjsLib.getDocument(url).then(function (pdfDoc_) {\n      pdfDoc = pdfDoc_;\n      vm.el.nativeElement.querySelector('#page_count').textContent = pdfDoc.numPages;\n      renderPage(pageNum);\n    });\n  }\n```\n\n结果如下图:\n![](/images/pdf.jpg)","slug":"预览PDF文件","published":1,"date":"2018-05-18T10:35:07.000Z","updated":"2018-05-18T10:35:07.000Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjkmaz65u0006fkq33puoaz2e","content":"<p>网上找到很多前端实现文件预览方法，但都无法解决我的问题，产品需求中将文件上传到腾讯云的对象存储，返回一个URL，这个URL无法在网页中预览，浏览器将这个URL直接本地下载文件（下载文件下面说）,最后只能用PDF.js，这是一个开源的js库，直接将PDF文件渲染成canvas，PDF.js框架的魅力所在，为其为HTML5实现的，无需任何本地支持，而且对浏览器的兼容性也是比较好，要求只有一个：浏览器支持HTML5就好了！（不过对于低版本的IE，就只能节哀了！）.不多说，直接贴代码(angular5.0开发):</p>\n<p>在线演示地址：<a href=\"http://mozilla.github.com/pdf.js/web/viewer.html\" target=\"_blank\" rel=\"noopener\">http://mozilla.github.com/pdf.js/web/viewer.html</a></p>\n<p>Demo地址：<a href=\"http://mozilla.github.io/pdf.js/examples/\" target=\"_blank\" rel=\"noopener\">http://mozilla.github.io/pdf.js/examples/</a></p>\n<p>PDF.js可在官网下载  地址：<a href=\"http://mozilla.github.io/pdf.js/\" target=\"_blank\" rel=\"noopener\">http://mozilla.github.io/pdf.js/</a><br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"the-canvas\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"the-canvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  margin: auto;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"m-t\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: fixed;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  right: 40px;\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"prev\"</span> <span class=\"attr\">nz-button</span> <span class=\"attr\">class</span>=<span class=\"string\">\"m-r-md\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"anticon anticon-left\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span>Previous<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"m-r-md\"</span>&gt;</span>Page: <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">\"page_num\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> / <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">\"page_count\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"next\"</span> <span class=\"attr\">nz-button</span>&gt;</span>Next<span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"anticon anticon-right\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>通过按钮控制页面加载<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">previewPDF(url) &#123;</span><br><span class=\"line\">   <span class=\"comment\">// url 为PDF文件的链接地址;</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> vm = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> pdfjsLib = <span class=\"built_in\">window</span>[<span class=\"string\">'pdfjs-dist/build/pdf'</span>];</span><br><span class=\"line\">   pdfjsLib.GlobalWorkerOptions.workerSrc = <span class=\"string\">'//mozilla.github.io/pdf.js/build/pdf.worker.js'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">let</span> pdfDoc = <span class=\"literal\">null</span>,</span><br><span class=\"line\">     pageNum = <span class=\"number\">1</span>,</span><br><span class=\"line\">     pageRendering = <span class=\"literal\">false</span>,</span><br><span class=\"line\">     pageNumPending = <span class=\"literal\">null</span>,</span><br><span class=\"line\">     scale = <span class=\"number\">1.6</span>,</span><br><span class=\"line\">     canvas = vm.el.nativeElement.querySelector(<span class=\"string\">'.the-canvas'</span>),</span><br><span class=\"line\">     ctx = canvas[<span class=\"string\">'getContext'</span>](<span class=\"string\">'2d'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderPage</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">     pageRendering = <span class=\"literal\">true</span>;</span><br><span class=\"line\">     pdfDoc.getPage(num).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">page</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> viewport = page.getViewport(scale);</span><br><span class=\"line\">       canvas[<span class=\"string\">'height'</span>] = viewport.height;</span><br><span class=\"line\">       canvas[<span class=\"string\">'width'</span>] = viewport.width;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">const</span> renderContext = &#123;</span><br><span class=\"line\">         canvasContext: ctx,</span><br><span class=\"line\">         viewport: viewport</span><br><span class=\"line\">       &#125;;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> renderTask = page.render(renderContext);</span><br><span class=\"line\"></span><br><span class=\"line\">       renderTask.promise.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         pageRendering = <span class=\"literal\">false</span>;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (pageNumPending !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">           renderPage(pageNumPending);</span><br><span class=\"line\">           pageNumPending = <span class=\"literal\">null</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">     &#125;);</span><br><span class=\"line\">     vm.el.nativeElement.querySelector(<span class=\"string\">'#page_num'</span>).textContent = num;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">queueRenderPage</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (pageRendering) &#123;</span><br><span class=\"line\">       pageNumPending = num;</span><br><span class=\"line\">     &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">       renderPage(num);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onPrevPage</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (pageNum &lt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     pageNum--;</span><br><span class=\"line\">     queueRenderPage(pageNum);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   vm.el.nativeElement.querySelector(<span class=\"string\">'#prev'</span>).addEventListener(<span class=\"string\">'click'</span>, onPrevPage);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onNextPage</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (pageNum &gt;= pdfDoc.numPages) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     pageNum++;</span><br><span class=\"line\">     queueRenderPage(pageNum);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   vm.el.nativeElement.querySelector(<span class=\"string\">'#next'</span>).addEventListener(<span class=\"string\">'click'</span>, onNextPage);</span><br><span class=\"line\"></span><br><span class=\"line\">   pdfjsLib.getDocument(url).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pdfDoc_</span>) </span>&#123;</span><br><span class=\"line\">     pdfDoc = pdfDoc_;</span><br><span class=\"line\">     vm.el.nativeElement.querySelector(<span class=\"string\">'#page_count'</span>).textContent = pdfDoc.numPages;</span><br><span class=\"line\">     renderPage(pageNum);</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure></p>\n<p>结果如下图:<br><img src=\"/images/pdf.jpg\" alt=\"\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>网上找到很多前端实现文件预览方法，但都无法解决我的问题，产品需求中将文件上传到腾讯云的对象存储，返回一个URL，这个URL无法在网页中预览，浏览器将这个URL直接本地下载文件（下载文件下面说）,最后只能用PDF.js，这是一个开源的js库，直接将PDF文件渲染成canvas，PDF.js框架的魅力所在，为其为HTML5实现的，无需任何本地支持，而且对浏览器的兼容性也是比较好，要求只有一个：浏览器支持HTML5就好了！（不过对于低版本的IE，就只能节哀了！）.不多说，直接贴代码(angular5.0开发):</p>\n<p>在线演示地址：<a href=\"http://mozilla.github.com/pdf.js/web/viewer.html\" target=\"_blank\" rel=\"noopener\">http://mozilla.github.com/pdf.js/web/viewer.html</a></p>\n<p>Demo地址：<a href=\"http://mozilla.github.io/pdf.js/examples/\" target=\"_blank\" rel=\"noopener\">http://mozilla.github.io/pdf.js/examples/</a></p>\n<p>PDF.js可在官网下载  地址：<a href=\"http://mozilla.github.io/pdf.js/\" target=\"_blank\" rel=\"noopener\">http://mozilla.github.io/pdf.js/</a><br><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">canvas</span> <span class=\"attr\">id</span>=<span class=\"string\">\"the-canvas\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"the-canvas\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: absolute;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  left: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  right: 0;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  margin: auto;\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">canvas</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">class</span>=<span class=\"string\">\"m-t\"</span> <span class=\"attr\">style</span>=<span class=\"string\">\"position: fixed;</span></span></span><br><span class=\"line\"><span class=\"tag\"><span class=\"string\">  right: 40px;\"</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"prev\"</span> <span class=\"attr\">nz-button</span> <span class=\"attr\">class</span>=<span class=\"string\">\"m-r-md\"</span>&gt;</span><span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"anticon anticon-left\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span>Previous<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"m-r-md\"</span>&gt;</span>Page: <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">\"page_num\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span> / <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">id</span>=<span class=\"string\">\"page_count\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></span><br><span class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">id</span>=<span class=\"string\">\"next\"</span> <span class=\"attr\">nz-button</span>&gt;</span>Next<span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"anticon anticon-right\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>通过按钮控制页面加载<br><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><span class=\"line\">previewPDF(url) &#123;</span><br><span class=\"line\">   <span class=\"comment\">// url 为PDF文件的链接地址;</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> vm = <span class=\"keyword\">this</span>;</span><br><span class=\"line\">   <span class=\"keyword\">const</span> pdfjsLib = <span class=\"built_in\">window</span>[<span class=\"string\">'pdfjs-dist/build/pdf'</span>];</span><br><span class=\"line\">   pdfjsLib.GlobalWorkerOptions.workerSrc = <span class=\"string\">'//mozilla.github.io/pdf.js/build/pdf.worker.js'</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"keyword\">let</span> pdfDoc = <span class=\"literal\">null</span>,</span><br><span class=\"line\">     pageNum = <span class=\"number\">1</span>,</span><br><span class=\"line\">     pageRendering = <span class=\"literal\">false</span>,</span><br><span class=\"line\">     pageNumPending = <span class=\"literal\">null</span>,</span><br><span class=\"line\">     scale = <span class=\"number\">1.6</span>,</span><br><span class=\"line\">     canvas = vm.el.nativeElement.querySelector(<span class=\"string\">'.the-canvas'</span>),</span><br><span class=\"line\">     ctx = canvas[<span class=\"string\">'getContext'</span>](<span class=\"string\">'2d'</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">renderPage</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">     pageRendering = <span class=\"literal\">true</span>;</span><br><span class=\"line\">     pdfDoc.getPage(num).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">page</span>) </span>&#123;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> viewport = page.getViewport(scale);</span><br><span class=\"line\">       canvas[<span class=\"string\">'height'</span>] = viewport.height;</span><br><span class=\"line\">       canvas[<span class=\"string\">'width'</span>] = viewport.width;</span><br><span class=\"line\"></span><br><span class=\"line\">       <span class=\"keyword\">const</span> renderContext = &#123;</span><br><span class=\"line\">         canvasContext: ctx,</span><br><span class=\"line\">         viewport: viewport</span><br><span class=\"line\">       &#125;;</span><br><span class=\"line\">       <span class=\"keyword\">const</span> renderTask = page.render(renderContext);</span><br><span class=\"line\"></span><br><span class=\"line\">       renderTask.promise.then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">         pageRendering = <span class=\"literal\">false</span>;</span><br><span class=\"line\">         <span class=\"keyword\">if</span> (pageNumPending !== <span class=\"literal\">null</span>) &#123;</span><br><span class=\"line\">           renderPage(pageNumPending);</span><br><span class=\"line\">           pageNumPending = <span class=\"literal\">null</span>;</span><br><span class=\"line\">         &#125;</span><br><span class=\"line\">       &#125;);</span><br><span class=\"line\">     &#125;);</span><br><span class=\"line\">     vm.el.nativeElement.querySelector(<span class=\"string\">'#page_num'</span>).textContent = num;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">queueRenderPage</span>(<span class=\"params\">num</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (pageRendering) &#123;</span><br><span class=\"line\">       pageNumPending = num;</span><br><span class=\"line\">     &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">       renderPage(num);</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onPrevPage</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (pageNum &lt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     pageNum--;</span><br><span class=\"line\">     queueRenderPage(pageNum);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   vm.el.nativeElement.querySelector(<span class=\"string\">'#prev'</span>).addEventListener(<span class=\"string\">'click'</span>, onPrevPage);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">onNextPage</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (pageNum &gt;= pdfDoc.numPages) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">return</span>;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     pageNum++;</span><br><span class=\"line\">     queueRenderPage(pageNum);</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">   vm.el.nativeElement.querySelector(<span class=\"string\">'#next'</span>).addEventListener(<span class=\"string\">'click'</span>, onNextPage);</span><br><span class=\"line\"></span><br><span class=\"line\">   pdfjsLib.getDocument(url).then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">pdfDoc_</span>) </span>&#123;</span><br><span class=\"line\">     pdfDoc = pdfDoc_;</span><br><span class=\"line\">     vm.el.nativeElement.querySelector(<span class=\"string\">'#page_count'</span>).textContent = pdfDoc.numPages;</span><br><span class=\"line\">     renderPage(pageNum);</span><br><span class=\"line\">   &#125;);</span><br><span class=\"line\"> &#125;</span><br></pre></td></tr></table></figure></p>\n<p>结果如下图:<br><img src=\"/images/pdf.jpg\" alt=\"\"></p>\n"}],"PostAsset":[],"PostCategory":[],"PostTag":[],"Tag":[]}}